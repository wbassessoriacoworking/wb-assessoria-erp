<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WB Assessoria MigratÃ³ria â€” ERP</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600;700&family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --navy: #0a0f1e;
    --navy2: #111827;
    --navy3: #1a2235;
    --navy4: #243048;
    --gold: #c9a84c;
    --gold2: #e4c97e;
    --gold3: #f5e4b0;
    --accent: #3b82f6;
    --green: #10b981;
    --red: #ef4444;
    --orange: #f59e0b;
    --text: #e8eaf2;
    --text2: #9aa3b8;
    --text3: #5a6380;
    --border: rgba(201,168,76,0.15);
    --border2: rgba(255,255,255,0.06);
    --glass: rgba(26,34,53,0.7);
    --shadow: 0 20px 60px rgba(0,0,0,0.5);
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family:'DM Sans',sans-serif; background:var(--navy); color:var(--text); min-height:100vh; overflow-x:hidden; }
  
  /* SCROLLBAR */
  ::-webkit-scrollbar { width:6px; }
  ::-webkit-scrollbar-track { background:var(--navy2); }
  ::-webkit-scrollbar-thumb { background:var(--gold); border-radius:3px; }

  /* â”€â”€â”€ LOGIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #login-screen {
    min-height:100vh; display:flex; align-items:center; justify-content:center;
    background: radial-gradient(ellipse 80% 60% at 50% 0%, rgba(201,168,76,0.08) 0%, transparent 70%),
                radial-gradient(ellipse 60% 80% at 80% 100%, rgba(59,130,246,0.05) 0%, transparent 70%),
                var(--navy);
    position:relative;
  }
  #login-screen::before {
    content:''; position:absolute; inset:0;
    background-image: repeating-linear-gradient(0deg, transparent, transparent 80px, rgba(255,255,255,0.015) 80px, rgba(255,255,255,0.015) 81px),
                      repeating-linear-gradient(90deg, transparent, transparent 80px, rgba(255,255,255,0.015) 80px, rgba(255,255,255,0.015) 81px);
  }
  .login-box {
    background: var(--glass); backdrop-filter:blur(20px);
    border:1px solid var(--border); border-radius:24px;
    padding:60px 56px; width:460px; max-width:95vw;
    box-shadow: var(--shadow), inset 0 1px 0 rgba(201,168,76,0.2);
    position:relative; z-index:1;
  }
  .login-logo { text-align:center; margin-bottom:40px; }
  .login-logo .brand { font-family:'Cormorant Garamond',serif; font-size:2.6rem; font-weight:700; color:var(--gold); letter-spacing:2px; }
  .login-logo .sub { font-size:0.7rem; letter-spacing:4px; color:var(--text2); text-transform:uppercase; margin-top:4px; }
  .login-logo .divider { width:60px; height:1px; background:linear-gradient(90deg,transparent,var(--gold),transparent); margin:16px auto; }
  .role-tabs { display:flex; gap:8px; margin-bottom:32px; background:var(--navy2); border-radius:12px; padding:4px; }
  .role-tab { flex:1; padding:10px; text-align:center; border-radius:9px; cursor:pointer; font-size:0.78rem; font-weight:500; letter-spacing:0.5px; color:var(--text3); transition:all 0.25s; border:none; background:transparent; }
  .role-tab.active { background:var(--gold); color:var(--navy); font-weight:600; }
  .form-group { margin-bottom:20px; }
  .form-group label { display:block; font-size:0.75rem; letter-spacing:1px; text-transform:uppercase; color:var(--text2); margin-bottom:8px; }
  .form-group input {
    width:100%; background:var(--navy2); border:1px solid var(--border2);
    border-radius:10px; padding:14px 16px; color:var(--text); font-family:'DM Sans',sans-serif;
    font-size:0.9rem; outline:none; transition:border-color 0.2s;
  }
  .form-group input:focus { border-color:var(--gold); }
  .login-btn {
    width:100%; padding:16px; background:linear-gradient(135deg,var(--gold),#a87f2e);
    border:none; border-radius:12px; color:var(--navy); font-family:'DM Sans',sans-serif;
    font-size:0.9rem; font-weight:700; letter-spacing:1px; cursor:pointer; transition:all 0.25s; margin-top:8px;
    text-transform:uppercase;
  }
  .login-btn:hover { transform:translateY(-2px); box-shadow:0 8px 30px rgba(201,168,76,0.4); }
  .demo-hint { text-align:center; margin-top:20px; font-size:0.75rem; color:var(--text3); }
  .demo-hint span { color:var(--gold); font-family:'DM Mono',monospace; }

  /* â”€â”€â”€ LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #app { display:none; flex-direction:row; min-height:100vh; }
  #app.active { display:flex; }

  /* SIDEBAR */
  .sidebar {
    width:260px; min-height:100vh; background:var(--navy2); border-right:1px solid var(--border2);
    display:flex; flex-direction:column; position:fixed; top:0; left:0; bottom:0; z-index:100;
    transition:transform 0.3s;
  }
  .sidebar-logo { padding:28px 24px 20px; border-bottom:1px solid var(--border2); }
  .sidebar-logo .brand { font-family:'Cormorant Garamond',serif; font-size:1.5rem; font-weight:700; color:var(--gold); }
  .sidebar-logo .sub { font-size:0.65rem; letter-spacing:3px; color:var(--text3); text-transform:uppercase; }
  .sidebar-user { padding:16px 24px; border-bottom:1px solid var(--border2); display:flex; align-items:center; gap:12px; }
  .user-avatar { width:40px; height:40px; border-radius:50%; background:linear-gradient(135deg,var(--gold),var(--navy4)); display:flex; align-items:center; justify-content:center; font-weight:700; font-size:0.85rem; color:var(--navy); flex-shrink:0; }
  .user-info .name { font-size:0.85rem; font-weight:600; color:var(--text); }
  .user-info .role-badge { font-size:0.65rem; letter-spacing:1px; text-transform:uppercase; color:var(--gold); }
  .sidebar-nav { flex:1; padding:12px 0; overflow-y:auto; }
  .nav-section { padding:8px 24px 4px; font-size:0.65rem; letter-spacing:2px; text-transform:uppercase; color:var(--text3); }
  .nav-item {
    display:flex; align-items:center; gap:12px; padding:11px 24px;
    cursor:pointer; transition:all 0.2s; font-size:0.85rem; color:var(--text2);
    border-left:3px solid transparent; position:relative;
  }
  .nav-item:hover { color:var(--text); background:rgba(255,255,255,0.03); }
  .nav-item.active { color:var(--gold); background:rgba(201,168,76,0.07); border-left-color:var(--gold); }
  .nav-item .icon { width:18px; text-align:center; font-size:1rem; }
  .nav-badge { margin-left:auto; background:var(--gold); color:var(--navy); font-size:0.65rem; font-weight:700; padding:2px 7px; border-radius:10px; }
  .sidebar-bottom { padding:16px 24px; border-top:1px solid var(--border2); }
  .logout-btn { display:flex; align-items:center; gap:10px; color:var(--text3); font-size:0.82rem; cursor:pointer; transition:color 0.2s; background:none; border:none; font-family:'DM Sans',sans-serif; }
  .logout-btn:hover { color:var(--red); }

  /* MAIN */
  .main { margin-left:260px; flex:1; display:flex; flex-direction:column; min-height:100vh; }
  .topbar {
    padding:18px 32px; border-bottom:1px solid var(--border2); display:flex; align-items:center;
    justify-content:space-between; background:rgba(10,15,30,0.8); backdrop-filter:blur(10px);
    position:sticky; top:0; z-index:50;
  }
  .topbar-title { font-family:'Cormorant Garamond',serif; font-size:1.5rem; font-weight:600; color:var(--text); }
  .topbar-right { display:flex; align-items:center; gap:16px; }
  .notif-btn { width:38px; height:38px; border-radius:10px; background:var(--navy3); border:1px solid var(--border2); display:flex; align-items:center; justify-content:center; cursor:pointer; font-size:1rem; position:relative; }
  .notif-dot { position:absolute; top:8px; right:8px; width:8px; height:8px; background:var(--gold); border-radius:50%; }
  .content { padding:32px; flex:1; }

  /* â”€â”€â”€ CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .stat-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:20px; margin-bottom:32px; }
  .stat-card {
    background:var(--navy3); border:1px solid var(--border2); border-radius:16px;
    padding:24px; position:relative; overflow:hidden; transition:transform 0.2s;
  }
  .stat-card:hover { transform:translateY(-3px); }
  .stat-card::after { content:''; position:absolute; top:0; left:0; right:0; height:3px; border-radius:16px 16px 0 0; }
  .stat-card.gold::after { background:linear-gradient(90deg,var(--gold),var(--gold2)); }
  .stat-card.blue::after { background:linear-gradient(90deg,#3b82f6,#60a5fa); }
  .stat-card.green::after { background:linear-gradient(90deg,#10b981,#34d399); }
  .stat-card.red::after { background:linear-gradient(90deg,#ef4444,#f87171); }
  .stat-label { font-size:0.72rem; letter-spacing:1.5px; text-transform:uppercase; color:var(--text3); margin-bottom:12px; }
  .stat-value { font-family:'Cormorant Garamond',serif; font-size:2.4rem; font-weight:700; color:var(--text); line-height:1; }
  .stat-sub { font-size:0.75rem; color:var(--text3); margin-top:8px; }
  .stat-icon { position:absolute; right:20px; top:20px; font-size:1.8rem; opacity:0.15; }

  /* GRID 2COL */
  .grid-2 { display:grid; grid-template-columns:1fr 1fr; gap:24px; margin-bottom:24px; }
  .grid-3 { display:grid; grid-template-columns:2fr 1fr; gap:24px; margin-bottom:24px; }

  /* PANEL */
  .panel {
    background:var(--navy3); border:1px solid var(--border2); border-radius:16px; overflow:hidden;
  }
  .panel-header { padding:20px 24px; border-bottom:1px solid var(--border2); display:flex; align-items:center; justify-content:space-between; }
  .panel-title { font-size:0.9rem; font-weight:600; color:var(--text); }
  .panel-body { padding:24px; }

  /* TABLE */
  .tbl { width:100%; border-collapse:collapse; }
  .tbl th { padding:10px 14px; text-align:left; font-size:0.68rem; letter-spacing:1.5px; text-transform:uppercase; color:var(--text3); border-bottom:1px solid var(--border2); }
  .tbl td { padding:14px 14px; font-size:0.82rem; color:var(--text2); border-bottom:1px solid rgba(255,255,255,0.03); }
  .tbl tr:hover td { background:rgba(255,255,255,0.02); color:var(--text); }
  .tbl tr:last-child td { border-bottom:none; }

  /* BADGE */
  .badge { display:inline-flex; align-items:center; gap:5px; padding:4px 10px; border-radius:20px; font-size:0.7rem; font-weight:600; letter-spacing:0.5px; }
  .badge-gold { background:rgba(201,168,76,0.15); color:var(--gold); }
  .badge-green { background:rgba(16,185,129,0.15); color:var(--green); }
  .badge-blue { background:rgba(59,130,246,0.15); color:#60a5fa; }
  .badge-red { background:rgba(239,68,68,0.15); color:#f87171; }
  .badge-orange { background:rgba(245,158,11,0.15); color:var(--orange); }
  .badge-gray { background:rgba(255,255,255,0.07); color:var(--text3); }
  .badge::before { content:'â—'; font-size:0.5rem; }

  /* PROGRESS */
  .progress-bar { height:6px; background:var(--navy4); border-radius:3px; overflow:hidden; }
  .progress-fill { height:100%; border-radius:3px; background:linear-gradient(90deg,var(--gold),var(--gold2)); transition:width 0.6s ease; }

  /* BTN */
  .btn { padding:10px 20px; border-radius:10px; border:none; cursor:pointer; font-family:'DM Sans',sans-serif; font-size:0.82rem; font-weight:600; letter-spacing:0.5px; transition:all 0.2s; display:inline-flex; align-items:center; gap:8px; }
  .btn-gold { background:var(--gold); color:var(--navy); }
  .btn-gold:hover { background:var(--gold2); transform:translateY(-1px); }
  .btn-outline { background:transparent; border:1px solid var(--border); color:var(--text2); }
  .btn-outline:hover { border-color:var(--gold); color:var(--gold); }
  .btn-sm { padding:7px 14px; font-size:0.75rem; }
  .btn-danger { background:rgba(239,68,68,0.15); color:#f87171; border:1px solid rgba(239,68,68,0.2); }

  /* TIMELINE */
  .timeline { position:relative; padding-left:24px; }
  .timeline::before { content:''; position:absolute; left:7px; top:0; bottom:0; width:2px; background:var(--border2); }
  .timeline-item { position:relative; padding-bottom:20px; }
  .timeline-dot { position:absolute; left:-20px; top:4px; width:14px; height:14px; border-radius:50%; background:var(--navy4); border:2px solid var(--text3); }
  .timeline-dot.done { background:var(--gold); border-color:var(--gold); }
  .timeline-dot.active { background:var(--accent); border-color:var(--accent); box-shadow:0 0 8px rgba(59,130,246,0.6); }
  .timeline-text { font-size:0.82rem; color:var(--text2); }
  .timeline-date { font-size:0.7rem; color:var(--text3); margin-top:2px; font-family:'DM Mono',monospace; }

  /* FORM */
  .form-grid { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
  .form-field { display:flex; flex-direction:column; gap:6px; }
  .form-field label { font-size:0.72rem; letter-spacing:1px; text-transform:uppercase; color:var(--text3); }
  .form-field input, .form-field select, .form-field textarea {
    background:var(--navy2); border:1px solid var(--border2); border-radius:10px;
    padding:12px 14px; color:var(--text); font-family:'DM Sans',sans-serif; font-size:0.85rem; outline:none; transition:border-color 0.2s;
  }
  .form-field input:focus, .form-field select:focus, .form-field textarea:focus { border-color:var(--gold); }
  .form-field select option { background:var(--navy2); }
  .form-field textarea { resize:vertical; min-height:90px; }
  .form-full { grid-column:1/-1; }

  /* MESSAGE */
  .msg-list { display:flex; flex-direction:column; gap:10px; }
  .msg-item { background:var(--navy4); border-radius:12px; padding:14px 16px; }
  .msg-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:6px; }
  .msg-from { font-size:0.78rem; font-weight:600; color:var(--gold); }
  .msg-time { font-size:0.68rem; color:var(--text3); font-family:'DM Mono',monospace; }
  .msg-text { font-size:0.82rem; color:var(--text2); line-height:1.5; }

  /* MODAL */
  .modal-overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:200; align-items:center; justify-content:center; }
  .modal-overlay.open { display:flex; }
  .modal { background:var(--navy2); border:1px solid var(--border); border-radius:20px; padding:36px; width:600px; max-width:95vw; max-height:90vh; overflow-y:auto; }
  .modal-title { font-family:'Cormorant Garamond',serif; font-size:1.6rem; font-weight:600; margin-bottom:24px; color:var(--gold); }
  .modal-actions { display:flex; gap:12px; margin-top:24px; justify-content:flex-end; }

  /* CHECKLIST */
  .checklist-item { display:flex; align-items:center; gap:12px; padding:10px 0; border-bottom:1px solid var(--border2); }
  .checklist-item:last-child { border-bottom:none; }
  .check-box { width:20px; height:20px; border-radius:5px; border:2px solid var(--text3); cursor:pointer; display:flex; align-items:center; justify-content:center; flex-shrink:0; transition:all 0.2s; }
  .check-box.checked { background:var(--gold); border-color:var(--gold); }
  .check-label { font-size:0.83rem; color:var(--text2); flex:1; }

  /* KANBAN */
  .kanban { display:grid; grid-template-columns:repeat(4,1fr); gap:16px; }
  .kanban-col { background:var(--navy3); border-radius:14px; padding:16px; }
  .kanban-col-title { font-size:0.72rem; letter-spacing:2px; text-transform:uppercase; color:var(--text3); margin-bottom:16px; display:flex; align-items:center; justify-content:space-between; }
  .kanban-card { background:var(--navy4); border-radius:10px; padding:14px; margin-bottom:10px; border:1px solid var(--border2); cursor:pointer; transition:all 0.2s; }
  .kanban-card:hover { border-color:var(--gold); transform:translateY(-2px); }
  .kanban-name { font-size:0.83rem; font-weight:600; color:var(--text); margin-bottom:6px; }
  .kanban-service { font-size:0.72rem; color:var(--text3); margin-bottom:8px; }

  /* FINANCE CHART */
  .chart-bar-group { display:flex; align-items:flex-end; gap:8px; height:120px; }
  .chart-bar-wrap { flex:1; display:flex; flex-direction:column; align-items:center; gap:6px; }
  .chart-bar { width:100%; background:linear-gradient(180deg,var(--gold),rgba(201,168,76,0.3)); border-radius:4px 4px 0 0; transition:height 0.6s; min-height:4px; }
  .chart-bar-label { font-size:0.65rem; color:var(--text3); }

  /* PAGE VIEWS */
  .page { display:none; }
  .page.active { display:block; }

  /* CLIENT PORTAL SPECIAL */
  .client-header {
    background: linear-gradient(135deg, var(--navy3), var(--navy4));
    border:1px solid var(--border); border-radius:20px; padding:32px;
    margin-bottom:24px; position:relative; overflow:hidden;
  }
  .client-header::before {
    content:''; position:absolute; right:-60px; top:-60px;
    width:200px; height:200px; border-radius:50%;
    background:radial-gradient(circle,rgba(201,168,76,0.1),transparent 70%);
  }
  .client-name { font-family:'Cormorant Garamond',serif; font-size:2rem; font-weight:700; color:var(--gold); }
  .client-process { font-size:0.8rem; color:var(--text3); margin-top:4px; letter-spacing:1px; }

  /* ANIMATIONS */
  @keyframes fadeIn { from{opacity:0;transform:translateY(12px)} to{opacity:1;transform:translateY(0)} }
  .page.active { animation:fadeIn 0.3s ease; }

  /* RESPONSIVE */
  @media(max-width:900px) {
    .stat-grid { grid-template-columns:1fr 1fr; }
    .grid-2, .grid-3 { grid-template-columns:1fr; }
    .kanban { grid-template-columns:1fr 1fr; }
  }
  @media(max-width:600px) {
    .sidebar { transform:translateX(-100%); }
    .main { margin-left:0; }
    .stat-grid { grid-template-columns:1fr; }
    .kanban { grid-template-columns:1fr; }
  }

  /* Divider with text */
  .divider-text { display:flex; align-items:center; gap:12px; color:var(--text3); font-size:0.72rem; letter-spacing:1px; text-transform:uppercase; margin:20px 0; }
  .divider-text::before, .divider-text::after { content:''; flex:1; height:1px; background:var(--border2); }

  /* NOTIFICATION PANEL */
  .notif-panel { position:absolute; right:0; top:52px; width:320px; background:var(--navy2); border:1px solid var(--border); border-radius:16px; box-shadow:var(--shadow); z-index:200; display:none; }
  .notif-panel.open { display:block; }
  .notif-item { padding:14px 16px; border-bottom:1px solid var(--border2); }
  .notif-item:last-child { border-bottom:none; }
  .notif-item-title { font-size:0.82rem; font-weight:600; color:var(--text); }
  .notif-item-sub { font-size:0.73rem; color:var(--text3); margin-top:2px; }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• LOGIN â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="login-screen">
  <div class="login-box">
    <div class="login-logo">
      <div class="brand">WB</div>
      <div class="divider"></div>
      <div class="sub">Assessoria MigratÃ³ria</div>
    </div>
    <div class="role-tabs">
      <button class="role-tab active" onclick="setRole('ceo')">Diretor</button>
      <button class="role-tab" onclick="setRole('colaborador')">Colaborador</button>
      <button class="role-tab" onclick="setRole('cliente')">Cliente</button>
    </div>
    <div class="form-group">
      <label>E-mail</label>
      <input type="email" id="login-email" placeholder="seu@email.com" value="ceo@wbassessoria.com.br">
    </div>
    <div class="form-group">
      <label>Senha</label>
      <input type="password" id="login-pass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" value="â€¢â€¢â€¢â€¢â€¢â€¢">
    </div>
    <button class="login-btn" onclick="doLogin()">Acessar Sistema</button>
    <div class="demo-hint">Demo: <span>ceo</span> / <span>colaborador</span> / <span>cliente</span></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• APP â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="app">

  <!-- SIDEBAR -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-logo">
      <div class="brand">WB</div>
      <div class="sub">Assessoria MigratÃ³ria</div>
    </div>
    <div class="sidebar-user">
      <div class="user-avatar" id="user-avatar">CEO</div>
      <div class="user-info">
        <div class="name" id="user-name">William Borges</div>
        <div class="role-badge" id="user-role">Diretor</div>
      </div>
    </div>
    <nav class="sidebar-nav" id="sidebar-nav"></nav>
    <div class="sidebar-bottom">
      <button class="logout-btn" onclick="doLogout()">â¬… Sair do sistema</button>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <div class="topbar">
      <div class="topbar-title" id="page-title">Dashboard</div>
      <div class="topbar-right">
        <div style="font-size:0.75rem;color:var(--text3);font-family:'DM Mono',monospace" id="topbar-date"></div>
        <div style="position:relative">
          <div class="notif-btn" onclick="toggleNotif()">ğŸ”” <div class="notif-dot"></div></div>
          <div class="notif-panel" id="notif-panel">
            <div style="padding:14px 16px;font-size:0.72rem;letter-spacing:1px;text-transform:uppercase;color:var(--text3);border-bottom:1px solid var(--border2)">NotificaÃ§Ãµes</div>
            <div class="notif-item"><div class="notif-item-title">ğŸ“„ Doc pendente â€” Ana Souza</div><div class="notif-item-sub">Aguardando CertidÃ£o de Nascimento â€¢ hÃ¡ 2h</div></div>
            <div class="notif-item"><div class="notif-item-title">âœ… Processo aprovado â€” Carlos Lima</div><div class="notif-item-sub">RNM Emitido com sucesso â€¢ hoje</div></div>
            <div class="notif-item"><div class="notif-item-title">ğŸ’° Pagamento recebido</div><div class="notif-item-sub">JoÃ£o Ferreira â€” R$ 3.500 â€¢ ontem</div></div>
            <div class="notif-item"><div class="notif-item-title">ğŸ“… ReuniÃ£o agendada</div><div class="notif-item-sub">Maria Oliveira â€” amanhÃ£ 14h</div></div>
          </div>
        </div>
      </div>
    </div>
    <div class="content" id="main-content"></div>
  </main>
</div>

<!-- MODAL -->
<div class="modal-overlay" id="modal" onclick="if(event.target===this)closeModal()">
  <div class="modal" id="modal-body"></div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const USERS = {
  ceo: { name:'William Borges', role:'ceo', roleLabel:'Diretor / CEO', avatar:'WB', email:'ceo@wbassessoria.com.br' },
  colaborador: { name:'Fernanda Costa', role:'colaborador', roleLabel:'Colaborador(a)', avatar:'FC', email:'fernanda@wbassessoria.com.br' },
  cliente: { name:'Ana Cristina Souza', role:'cliente', roleLabel:'Cliente', avatar:'AS', email:'ana.souza@email.com' }
};

const CLIENTES = [
  { id:1, nome:'Ana Cristina Souza', email:'ana.souza@email.com', tel:'(11) 9 9876-5432', cpf:'123.456.789-00', pais:'Brasil', servico:'NaturalizaÃ§Ã£o Brasileira', status:'Em andamento', etapa:3, totalEtapas:6, responsavel:'Fernanda Costa', prioridade:'alta', dataCadastro:'10/01/2025', valor:4500, pago:true, docs:['RG','CPF','CertidÃ£o de Nascimento'], docsPendentes:['Comprovante de ResidÃªncia 5 anos','CertidÃ£o de Antecedentes'], obs:'Cliente aguarda regularizaÃ§Ã£o de certidÃµes.' },
  { id:2, nome:'Carlos Eduardo Lima', email:'carlos.lima@email.com', tel:'(21) 9 8765-4321', cpf:'987.654.321-00', pais:'Portugal', servico:'AutorizaÃ§Ã£o de ResidÃªncia (RNM)', status:'ConcluÃ­do', etapa:5, totalEtapas:5, responsavel:'Fernanda Costa', prioridade:'normal', dataCadastro:'05/12/2024', valor:3800, pago:true, docs:['Passaporte','Visto','Contrato de Trabalho'], docsPendentes:[], obs:'RNM emitido. Processo encerrado.' },
  { id:3, nome:'JoÃ£o Pedro Ferreira', email:'joao.ferreira@email.com', tel:'(31) 9 7654-3210', cpf:'456.789.123-00', pais:'ItÃ¡lia', servico:'NaturalizaÃ§Ã£o Brasileira', status:'Pendente DocumentaÃ§Ã£o', etapa:1, totalEtapas:6, responsavel:'Fernanda Costa', prioridade:'alta', dataCadastro:'20/01/2025', valor:4500, pago:false, docs:[], docsPendentes:['CertidÃ£o de Nascimento','Comprovante de ResidÃªncia','Antecedentes Criminais'], obs:'Cliente precisa providenciar documentos iniciais.' },
  { id:4, nome:'Maria Fernanda Oliveira', email:'maria.oliveira@email.com', tel:'(85) 9 5432-1098', cpf:'321.654.987-00', pais:'USA', servico:'Visto de Turismo (EUA)', status:'Em andamento', etapa:2, totalEtapas:4, responsavel:'Fernanda Costa', prioridade:'normal', dataCadastro:'15/01/2025', valor:2800, pago:true, docs:['Passaporte','Comprovante Financeiro'], docsPendentes:['FormulÃ¡rio DS-160','Agendamento Entrevista'], obs:'Aguardando agendamento consular.' },
  { id:5, nome:'Roberto Silva Santos', email:'roberto.santos@email.com', tel:'(41) 9 6543-2109', cpf:'654.321.789-00', pais:'Espanha', servico:'AutorizaÃ§Ã£o de ResidÃªncia (RNM)', status:'Em andamento', etapa:2, totalEtapas:5, responsavel:'Fernanda Costa', prioridade:'baixa', dataCadastro:'08/02/2025', valor:3800, pago:false, docs:['Passaporte','Visto de Trabalho'], docsPendentes:['Registro Policial','Comprovante de EndereÃ§o BR'], obs:'Em coleta de documentaÃ§Ã£o complementar.' },
  { id:6, nome:'Lucia Aparecida Mendes', email:'lucia.mendes@email.com', tel:'(48) 9 4321-0987', cpf:'789.123.456-00', pais:'Argentina', servico:'Visto de Turismo (EUA)', status:'ConcluÃ­do', etapa:4, totalEtapas:4, responsavel:'Fernanda Costa', prioridade:'normal', dataCadastro:'02/11/2024', valor:2800, pago:true, docs:['Passaporte','DS-160','FormulÃ¡rios consulares'], docsPendentes:[], obs:'Visto emitido com sucesso.' },
];

const TAREFAS = [
  { id:1, titulo:'Revisar documentaÃ§Ã£o Ana Souza', prioridade:'alta', prazo:'28/02/2025', status:'pendente', cliente:'Ana Cristina Souza', responsavel:'Fernanda Costa' },
  { id:2, titulo:'Protocolar pedido JoÃ£o Ferreira', prioridade:'alta', prazo:'01/03/2025', status:'andamento', cliente:'JoÃ£o Pedro Ferreira', responsavel:'Fernanda Costa' },
  { id:3, titulo:'Agendar entrevista Maria Oliveira', prioridade:'normal', prazo:'05/03/2025', status:'andamento', cliente:'Maria Fernanda Oliveira', responsavel:'Fernanda Costa' },
  { id:4, titulo:'Enviar comprovante Carlos Lima', prioridade:'baixa', prazo:'10/03/2025', status:'concluida', cliente:'Carlos Eduardo Lima', responsavel:'Fernanda Costa' },
  { id:5, titulo:'Coleta docs Roberto Santos', prioridade:'normal', prazo:'15/03/2025', status:'pendente', cliente:'Roberto Silva Santos', responsavel:'Fernanda Costa' },
];

const FINANCEIRO = [
  { mes:'Set', receita:12400, despesa:4200 },
  { mes:'Out', receita:15800, despesa:5100 },
  { mes:'Nov', receita:11200, despesa:3800 },
  { mes:'Dez', receita:18600, despesa:6200 },
  { mes:'Jan', receita:16400, despesa:5400 },
  { mes:'Fev', receita:21200, despesa:7100 },
];

const AGENDAMENTOS = [
  { data:'27/02/2025', hora:'09:00', cliente:'Ana Cristina Souza', tipo:'Consulta Inicial', colaborador:'Fernanda Costa' },
  { data:'27/02/2025', hora:'14:00', cliente:'Roberto Silva Santos', tipo:'Entrega de Documentos', colaborador:'Fernanda Costa' },
  { data:'28/02/2025', hora:'10:30', cliente:'Maria Fernanda Oliveira', tipo:'AtualizaÃ§Ã£o de Processo', colaborador:'Fernanda Costa' },
  { data:'01/03/2025', hora:'15:00', cliente:'JoÃ£o Pedro Ferreira', tipo:'Consulta Inicial', colaborador:'Fernanda Costa' },
  { data:'03/03/2025', hora:'11:00', cliente:'Carlos Eduardo Lima', tipo:'Entrega Final', colaborador:'Fernanda Costa' },
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentUser = null;
let currentRole = 'ceo';
let currentPage = '';
let clientes = [...CLIENTES];
let tarefas = [...TAREFAS];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOGIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setRole(r) {
  currentRole = r;
  document.querySelectorAll('.role-tab').forEach((t,i) => {
    const roles = ['ceo','colaborador','cliente'];
    t.classList.toggle('active', roles[i] === r);
  });
  const emails = { ceo:'ceo@wbassessoria.com.br', colaborador:'fernanda@wbassessoria.com.br', cliente:'ana.souza@email.com' };
  document.getElementById('login-email').value = emails[r];
}

function doLogin() {
  currentUser = USERS[currentRole];
  document.getElementById('login-screen').style.display = 'none';
  document.getElementById('app').classList.add('active');
  document.getElementById('user-avatar').textContent = currentUser.avatar;
  document.getElementById('user-name').textContent = currentUser.name;
  document.getElementById('user-role').textContent = currentUser.roleLabel;
  buildNav();
  setDate();
  navigateTo(getDefaultPage());
}

function doLogout() {
  document.getElementById('login-screen').style.display = 'flex';
  document.getElementById('app').classList.remove('active');
  currentUser = null;
}

function getDefaultPage() {
  if (currentRole === 'cliente') return 'meu-processo';
  return 'dashboard';
}

function setDate() {
  const now = new Date();
  document.getElementById('topbar-date').textContent = now.toLocaleDateString('pt-BR',{weekday:'short',day:'2-digit',month:'short',year:'numeric'});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAV
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildNav() {
  const nav = document.getElementById('sidebar-nav');
  let html = '';

  if (currentRole === 'cliente') {
    html = `
      <div class="nav-section">Minha Ãrea</div>
      ${navItem('meu-processo','ğŸ“‹','Meu Processo')}
      ${navItem('meus-documentos','ğŸ“','Meus Documentos')}
      ${navItem('mensagens-cliente','ğŸ’¬','Mensagens','2')}
      ${navItem('agendamentos-cliente','ğŸ“…','Meus Agendamentos')}
      <div class="nav-section">InformaÃ§Ãµes</div>
      ${navItem('faq-cliente','ğŸ“š','DÃºvidas Frequentes')}
      ${navItem('calculadora-cliente','ğŸ§®','Sou ElegÃ­vel?')}
    `;
  } else if (currentRole === 'colaborador') {
    html = `
      <div class="nav-section">OperaÃ§Ãµes</div>
      ${navItem('dashboard','ğŸ ','Dashboard')}
      ${navItem('clientes','ğŸ‘¥','Clientes')}
      ${navItem('processos','âš™ï¸','Processos')}
      ${navItem('tarefas','âœ…','Minhas Tarefas','3')}
      ${navItem('agendamentos','ğŸ“…','Agendamentos')}
      ${navItem('prazos','â°','Prazos & Alertas','2')}
      <div class="nav-section">Ferramentas</div>
      ${navItem('calculadora','ğŸ§®','Calculadora de Elegibilidade')}
      ${navItem('modelos','ğŸ“„','Modelos de Documentos')}
      ${navItem('indeferimentos','âŒ','Indeferimentos & Recursos')}
      ${navItem('parceiros','ğŸ¤','Rede de Parceiros')}
      <div class="nav-section">ServiÃ§os</div>
      ${navItem('servico-nat','ğŸ‡§ğŸ‡·','NaturalizaÃ§Ã£o')}
      ${navItem('servico-rnm','ğŸªª','RNM / RNE')}
      ${navItem('servico-visto','âœˆï¸','Visto EUA')}
      <div class="nav-section">Conhecimento</div>
      ${navItem('faq','ğŸ“š','Base de Conhecimento')}
    `;
  } else {
    html = `
      <div class="nav-section">VisÃ£o Geral</div>
      ${navItem('dashboard','ğŸ ','Dashboard')}
      ${navItem('financeiro','ğŸ’°','Financeiro')}
      ${navItem('financeiro-avancado','ğŸ’³','Financeiro AvanÃ§ado')}
      ${navItem('relatorios','ğŸ“Š','RelatÃ³rios')}
      <div class="nav-section">GestÃ£o</div>
      ${navItem('clientes','ğŸ‘¥','Clientes')}
      ${navItem('processos','âš™ï¸','Processos')}
      ${navItem('colaboradores','ğŸ‘”','Colaboradores')}
      ${navItem('agendamentos','ğŸ“…','Agenda')}
      ${navItem('prazos','â°','Prazos & Alertas','2')}
      <div class="nav-section">Ferramentas</div>
      ${navItem('calculadora','ğŸ§®','Calculadora de Elegibilidade')}
      ${navItem('modelos','ğŸ“„','Modelos de Documentos')}
      ${navItem('contratos','ğŸ“‘','Contratos & Propostas')}
      ${navItem('indeferimentos','âŒ','Indeferimentos & Recursos')}
      ${navItem('parceiros','ğŸ¤','Rede de Parceiros')}
      <div class="nav-section">ServiÃ§os</div>
      ${navItem('servico-nat','ğŸ‡§ğŸ‡·','NaturalizaÃ§Ã£o')}
      ${navItem('servico-rnm','ğŸªª','RNM / RNE')}
      ${navItem('servico-visto','âœˆï¸','Visto EUA')}
      <div class="nav-section">Conhecimento & Config.</div>
      ${navItem('faq','ğŸ“š','Base de Conhecimento')}
      ${navItem('configuracoes','âš™ï¸','ConfiguraÃ§Ãµes')}
    `;
  }
  nav.innerHTML = html;
}

function navItem(page, icon, label, badge='') {
  return `<div class="nav-item" id="nav-${page}" onclick="navigateTo('${page}')">
    <span class="icon">${icon}</span> ${label}
    ${badge ? `<span class="nav-badge">${badge}</span>` : ''}
  </div>`;
}

function navigateTo(page) {
  currentPage = page;
  document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
  const el = document.getElementById('nav-'+page);
  if (el) el.classList.add('active');
  const titles = {
    'dashboard':'Dashboard', 'clientes':'Clientes', 'processos':'Processos',
    'tarefas':'Minhas Tarefas', 'financeiro':'Financeiro', 'relatorios':'RelatÃ³rios',
    'colaboradores':'Colaboradores', 'agendamentos':'Agenda', 'configuracoes':'ConfiguraÃ§Ãµes',
    'servico-nat':'NaturalizaÃ§Ã£o Brasileira', 'servico-rnm':'AutorizaÃ§Ã£o de ResidÃªncia (RNM/RNE)',
    'servico-visto':'Visto de Turismo (EUA)',
    'meu-processo':'Meu Processo', 'meus-documentos':'Meus Documentos',
    'mensagens-cliente':'Mensagens', 'agendamentos-cliente':'Meus Agendamentos',
    'calculadora':'Calculadora de Elegibilidade', 'calculadora-cliente':'Sou ElegÃ­vel?',
    'prazos':'Prazos & Alertas de Vencimento',
    'modelos':'Modelos de Documentos',
    'contratos':'Contratos & Propostas',
    'indeferimentos':'Indeferimentos & Recursos',
    'parceiros':'Rede de Parceiros',
    'faq':'Base de Conhecimento MigratÃ³rio',
    'faq-cliente':'DÃºvidas Frequentes',
    'financeiro-avancado':'Financeiro AvanÃ§ado'
  };
  document.getElementById('page-title').textContent = titles[page] || page;
  renderPage(page);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER PAGES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderPage(page) {
  const c = document.getElementById('main-content');
  const pages = {
    'dashboard': renderDashboard,
    'clientes': renderClientes,
    'processos': renderProcessos,
    'tarefas': renderTarefas,
    'financeiro': renderFinanceiro,
    'relatorios': renderRelatorios,
    'colaboradores': renderColaboradores,
    'agendamentos': renderAgendamentos,
    'configuracoes': renderConfiguracoes,
    'servico-nat': () => renderServico('nat'),
    'servico-rnm': () => renderServico('rnm'),
    'servico-visto': () => renderServico('visto'),
    'meu-processo': renderMeuProcesso,
    'meus-documentos': renderMeusDocumentos,
    'mensagens-cliente': renderMensagensCliente,
    'agendamentos-cliente': renderAgendamentosCliente,
    'calculadora': renderCalculadora,
    'calculadora-cliente': renderCalculadora,
    'prazos': renderPrazos,
    'modelos': renderModelos,
    'contratos': renderContratos,
    'indeferimentos': renderIndeferimentos,
    'parceiros': renderParceiros,
    'faq': renderFaq,
    'faq-cliente': renderFaqCliente,
    'financeiro-avancado': renderFinanceiroAvancado,
  };
  if (pages[page]) { c.innerHTML = ''; c.innerHTML = pages[page](); }
  else c.innerHTML = `<div style="color:var(--text3);text-align:center;padding:60px">PÃ¡gina em construÃ§Ã£o</div>`;
}

// â”€â”€â”€ DASHBOARD â”€â”€â”€
function renderDashboard() {
  const total = clientes.length;
  const ativos = clientes.filter(c => c.status === 'Em andamento').length;
  const concluidos = clientes.filter(c => c.status === 'ConcluÃ­do').length;
  const receitaTotal = clientes.filter(c=>c.pago).reduce((a,b)=>a+b.valor,0);
  const maxReceita = Math.max(...FINANCEIRO.map(f=>f.receita));

  return `
    <div class="stat-grid">
      <div class="stat-card gold"><div class="stat-icon">ğŸ‘¥</div><div class="stat-label">Total de Clientes</div><div class="stat-value">${total}</div><div class="stat-sub">Todos os serviÃ§os</div></div>
      <div class="stat-card blue"><div class="stat-icon">âš™ï¸</div><div class="stat-label">Processos Ativos</div><div class="stat-value">${ativos}</div><div class="stat-sub">Em andamento</div></div>
      <div class="stat-card green"><div class="stat-icon">âœ…</div><div class="stat-label">ConcluÃ­dos</div><div class="stat-value">${concluidos}</div><div class="stat-sub">Este ano</div></div>
      <div class="stat-card red"><div class="stat-icon">ğŸ’°</div><div class="stat-label">Receita Total</div><div class="stat-value">R$${(receitaTotal/1000).toFixed(0)}k</div><div class="stat-sub">Processada</div></div>
    </div>

    <div class="grid-3">
      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">Processos Recentes</span>
          <button class="btn btn-outline btn-sm" onclick="navigateTo('clientes')">Ver todos</button>
        </div>
        <div class="panel-body" style="padding:0">
          <table class="tbl">
            <thead><tr><th>Cliente</th><th>ServiÃ§o</th><th>Status</th><th>Progresso</th></tr></thead>
            <tbody>
              ${clientes.slice(0,5).map(c=>`
                <tr style="cursor:pointer" onclick="openClienteModal(${c.id})">
                  <td><strong style="color:var(--text)">${c.nome.split(' ').slice(0,2).join(' ')}</strong></td>
                  <td style="font-size:0.75rem">${servicoBadge(c.servico)}</td>
                  <td>${statusBadge(c.status)}</td>
                  <td style="min-width:80px"><div class="progress-bar" style="width:80px"><div class="progress-fill" style="width:${Math.round(c.etapa/c.totalEtapas*100)}%"></div></div></td>
                </tr>`).join('')}
            </tbody>
          </table>
        </div>
      </div>

      <div style="display:flex;flex-direction:column;gap:20px">
        <div class="panel">
          <div class="panel-header"><span class="panel-title">Receita Mensal</span></div>
          <div class="panel-body">
            <div class="chart-bar-group">
              ${FINANCEIRO.map(f=>`
                <div class="chart-bar-wrap">
                  <div class="chart-bar" style="height:${Math.round(f.receita/maxReceita*100)}px" title="R$${f.receita.toLocaleString('pt-BR')}"></div>
                  <div class="chart-bar-label">${f.mes}</div>
                </div>`).join('')}
            </div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-header"><span class="panel-title">DistribuiÃ§Ã£o de ServiÃ§os</span></div>
          <div class="panel-body" style="display:flex;flex-direction:column;gap:12px">
            ${[['NaturalizaÃ§Ã£o','ğŸ‡§ğŸ‡·',clientes.filter(c=>c.servico.includes('NaturalizaÃ§Ã£o')).length,total],
               ['RNM / RNE','ğŸªª',clientes.filter(c=>c.servico.includes('RNM')).length,total],
               ['Visto EUA','âœˆï¸',clientes.filter(c=>c.servico.includes('Visto')).length,total]].map(([s,ic,n,t])=>`
              <div>
                <div style="display:flex;justify-content:space-between;margin-bottom:6px;font-size:0.8rem">
                  <span>${ic} ${s}</span><span style="color:var(--gold);font-weight:600">${n}</span>
                </div>
                <div class="progress-bar"><div class="progress-fill" style="width:${Math.round(n/t*100)}%"></div></div>
              </div>`).join('')}
          </div>
        </div>
      </div>
    </div>

    <div class="grid-2">
      <div class="panel">
        <div class="panel-header"><span class="panel-title">ğŸ“… Agenda do Dia</span></div>
        <div class="panel-body" style="padding:0">
          <table class="tbl">
            <thead><tr><th>Hora</th><th>Cliente</th><th>Tipo</th></tr></thead>
            <tbody>
              ${AGENDAMENTOS.slice(0,4).map(a=>`
                <tr><td style="font-family:'DM Mono',monospace;font-size:0.78rem;color:var(--gold)">${a.hora}</td><td>${a.cliente.split(' ').slice(0,2).join(' ')}</td><td style="font-size:0.75rem;color:var(--text3)">${a.tipo}</td></tr>`).join('')}
            </tbody>
          </table>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header"><span class="panel-title">âš ï¸ Alertas & PendÃªncias</span></div>
        <div class="panel-body" style="display:flex;flex-direction:column;gap:10px">
          ${clientes.filter(c=>c.docsPendentes.length>0).map(c=>`
            <div style="background:var(--navy4);border-radius:10px;padding:12px 14px;border-left:3px solid var(--orange)">
              <div style="font-size:0.82rem;font-weight:600;color:var(--text)">${c.nome.split(' ').slice(0,2).join(' ')}</div>
              <div style="font-size:0.72rem;color:var(--text3);margin-top:3px">${c.docsPendentes.length} documento(s) pendente(s)</div>
            </div>`).join('')}
        </div>
      </div>
    </div>
  `;
}

// â”€â”€â”€ CLIENTES â”€â”€â”€
function renderClientes() {
  return `
    <div style="display:flex;gap:12px;margin-bottom:24px;align-items:center">
      <input type="text" placeholder="ğŸ”  Buscar cliente..." oninput="filterClientes(this.value)"
        style="background:var(--navy3);border:1px solid var(--border2);border-radius:10px;padding:12px 16px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:0.85rem;outline:none;flex:1">
      <select onchange="filterClienteStatus(this.value)" style="background:var(--navy3);border:1px solid var(--border2);border-radius:10px;padding:12px 16px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:0.82rem;outline:none">
        <option value="">Todos os Status</option>
        <option value="Em andamento">Em andamento</option>
        <option value="ConcluÃ­do">ConcluÃ­do</option>
        <option value="Pendente DocumentaÃ§Ã£o">Pendente DocumentaÃ§Ã£o</option>
      </select>
      ${currentRole !== 'colaborador' || true ? `<button class="btn btn-gold" onclick="openNovoCliente()">+ Novo Cliente</button>` : ''}
    </div>

    <div class="panel">
      <div class="panel-header"><span class="panel-title">Clientes Cadastrados (${clientes.length})</span></div>
      <div id="tabela-clientes">
        ${tabelaClientes(clientes)}
      </div>
    </div>
  `;
}

function tabelaClientes(lista) {
  return `<table class="tbl">
    <thead><tr><th>Cliente</th><th>ServiÃ§o</th><th>Status</th><th>ResponsÃ¡vel</th><th>Valor</th><th>Pgto</th><th>AÃ§Ãµes</th></tr></thead>
    <tbody>
      ${lista.map(c=>`
        <tr>
          <td>
            <div style="font-weight:600;color:var(--text)">${c.nome}</div>
            <div style="font-size:0.72rem;color:var(--text3)">${c.email}</div>
          </td>
          <td style="font-size:0.78rem">${servicoBadge(c.servico)}</td>
          <td>${statusBadge(c.status)}</td>
          <td style="font-size:0.8rem">${c.responsavel}</td>
          <td style="font-family:'DM Mono',monospace;font-size:0.8rem;color:var(--gold)">R$ ${c.valor.toLocaleString('pt-BR')}</td>
          <td>${c.pago ? '<span class="badge badge-green">âœ“ Pago</span>' : '<span class="badge badge-red">Pendente</span>'}</td>
          <td><button class="btn btn-outline btn-sm" onclick="openClienteModal(${c.id})">Detalhes</button></td>
        </tr>`).join('')}
    </tbody>
  </table>`;
}

function filterClientes(q) {
  const lista = clientes.filter(c => c.nome.toLowerCase().includes(q.toLowerCase()) || c.email.toLowerCase().includes(q.toLowerCase()));
  document.getElementById('tabela-clientes').innerHTML = tabelaClientes(lista);
}
function filterClienteStatus(s) {
  const lista = s ? clientes.filter(c=>c.status===s) : clientes;
  document.getElementById('tabela-clientes').innerHTML = tabelaClientes(lista);
}

// â”€â”€â”€ PROCESSOS (KANBAN) â”€â”€â”€
function renderProcessos() {
  const cols = [
    { label:'Pendente Docs', key:'Pendente DocumentaÃ§Ã£o', color:'var(--orange)' },
    { label:'Em Andamento', key:'Em andamento', color:'var(--accent)' },
    { label:'AnÃ¡lise Final', key:'AnÃ¡lise Final', color:'var(--gold)' },
    { label:'ConcluÃ­do', key:'ConcluÃ­do', color:'var(--green)' },
  ];
  return `
    <div class="kanban">
      ${cols.map(col=>`
        <div class="kanban-col">
          <div class="kanban-col-title">
            <span style="color:${col.color}">${col.label}</span>
            <span>${clientes.filter(c=>c.status===col.key).length}</span>
          </div>
          ${clientes.filter(c=>c.status===col.key).map(c=>`
            <div class="kanban-card" onclick="openClienteModal(${c.id})">
              <div class="kanban-name">${c.nome.split(' ').slice(0,2).join(' ')}</div>
              <div class="kanban-service">${c.servico}</div>
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div class="progress-bar" style="width:70px"><div class="progress-fill" style="width:${Math.round(c.etapa/c.totalEtapas*100)}%"></div></div>
                <span style="font-size:0.7rem;color:var(--text3)">${c.etapa}/${c.totalEtapas}</span>
              </div>
            </div>`).join('')}
          ${clientes.filter(c=>c.status===col.key).length===0 ? `<div style="text-align:center;padding:20px;color:var(--text3);font-size:0.78rem">Nenhum processo</div>` : ''}
        </div>`).join('')}
    </div>
  `;
}

// â”€â”€â”€ TAREFAS â”€â”€â”€
function renderTarefas() {
  const prioColor = { alta:'var(--red)', normal:'var(--gold)', baixa:'var(--text3)' };
  return `
    <div style="display:flex;gap:12px;margin-bottom:24px">
      <button class="btn btn-gold" onclick="openNovaTarefa()">+ Nova Tarefa</button>
    </div>
    <div class="panel">
      <div class="panel-header"><span class="panel-title">Tarefas (${tarefas.length})</span></div>
      <div class="panel-body" style="padding:0">
        <table class="tbl">
          <thead><tr><th>Tarefa</th><th>Cliente</th><th>Prioridade</th><th>Prazo</th><th>Status</th><th></th></tr></thead>
          <tbody>
            ${tarefas.map((t,i)=>`
              <tr>
                <td style="font-weight:500;color:var(--text)">${t.titulo}</td>
                <td style="font-size:0.78rem;color:var(--text3)">${t.cliente}</td>
                <td><span style="color:${prioColor[t.prioridade]};font-size:0.78rem;font-weight:600">â— ${t.prioridade}</span></td>
                <td style="font-family:'DM Mono',monospace;font-size:0.78rem">${t.prazo}</td>
                <td>${tarefaStatusBadge(t.status)}</td>
                <td><button class="btn btn-sm btn-outline" onclick="avanÃ§arTarefa(${i})">â†’</button></td>
              </tr>`).join('')}
          </tbody>
        </table>
      </div>
    </div>
  `;
}

// â”€â”€â”€ FINANCEIRO â”€â”€â”€
function renderFinanceiro() {
  const totalReceita = FINANCEIRO.reduce((a,b)=>a+b.receita,0);
  const totalDespesa = FINANCEIRO.reduce((a,b)=>a+b.despesa,0);
  const lucro = totalReceita - totalDespesa;
  const maxR = Math.max(...FINANCEIRO.map(f=>f.receita));
  const pagos = clientes.filter(c=>c.pago).reduce((a,b)=>a+b.valor,0);
  const apagar = clientes.filter(c=>!c.pago).reduce((a,b)=>a+b.valor,0);

  return `
    <div class="stat-grid">
      <div class="stat-card gold"><div class="stat-icon">ğŸ“ˆ</div><div class="stat-label">Receita Total (6m)</div><div class="stat-value">R$${(totalReceita/1000).toFixed(0)}k</div><div class="stat-sub">Ãšltimos 6 meses</div></div>
      <div class="stat-card red"><div class="stat-icon">ğŸ“‰</div><div class="stat-label">Despesas (6m)</div><div class="stat-value">R$${(totalDespesa/1000).toFixed(0)}k</div><div class="stat-sub">Ãšltimos 6 meses</div></div>
      <div class="stat-card green"><div class="stat-icon">ğŸ’</div><div class="stat-label">Lucro LÃ­quido</div><div class="stat-value">R$${(lucro/1000).toFixed(0)}k</div><div class="stat-sub">6 meses</div></div>
      <div class="stat-card blue"><div class="stat-icon">â³</div><div class="stat-label">A Receber</div><div class="stat-value">R$${(apagar/1000).toFixed(1)}k</div><div class="stat-sub">Pendente de clientes</div></div>
    </div>

    <div class="grid-2">
      <div class="panel">
        <div class="panel-header"><span class="panel-title">Receita vs Despesa</span></div>
        <div class="panel-body">
          <div style="display:flex;gap:12px;align-items:flex-end;height:160px">
            ${FINANCEIRO.map(f=>`
              <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;justify-content:flex-end">
                <div style="display:flex;gap:3px;align-items:flex-end;width:100%">
                  <div style="flex:1;background:linear-gradient(180deg,var(--gold),rgba(201,168,76,0.4));border-radius:4px 4px 0 0;height:${Math.round(f.receita/maxR*130)}px"></div>
                  <div style="flex:1;background:linear-gradient(180deg,#ef4444,rgba(239,68,68,0.3));border-radius:4px 4px 0 0;height:${Math.round(f.despesa/maxR*130)}px"></div>
                </div>
                <div style="font-size:0.65rem;color:var(--text3)">${f.mes}</div>
              </div>`).join('')}
          </div>
          <div style="display:flex;gap:16px;margin-top:14px;font-size:0.75rem">
            <span style="color:var(--gold)">â–  Receita</span>
            <span style="color:#f87171">â–  Despesa</span>
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header"><span class="panel-title">Pagamentos Clientes</span></div>
        <div class="panel-body" style="padding:0">
          <table class="tbl">
            <thead><tr><th>Cliente</th><th>Valor</th><th>Status</th></tr></thead>
            <tbody>
              ${clientes.map(c=>`
                <tr>
                  <td style="font-size:0.8rem">${c.nome.split(' ').slice(0,2).join(' ')}</td>
                  <td style="font-family:'DM Mono',monospace;font-size:0.78rem;color:var(--gold)">R$ ${c.valor.toLocaleString('pt-BR')}</td>
                  <td>${c.pago ? '<span class="badge badge-green">Pago</span>' : '<span class="badge badge-red">Pendente</span>'}</td>
                </tr>`).join('')}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  `;
}

// â”€â”€â”€ RELATÃ“RIOS â”€â”€â”€
function renderRelatorios() {
  const nat = clientes.filter(c=>c.servico.includes('NaturalizaÃ§Ã£o')).length;
  const rnm = clientes.filter(c=>c.servico.includes('RNM')).length;
  const visto = clientes.filter(c=>c.servico.includes('Visto')).length;
  const taxa = Math.round(clientes.filter(c=>c.status==='ConcluÃ­do').length/clientes.length*100);

  return `
    <div class="stat-grid">
      <div class="stat-card gold"><div class="stat-label">Taxa de ConclusÃ£o</div><div class="stat-value">${taxa}%</div></div>
      <div class="stat-card blue"><div class="stat-label">NaturalizaÃ§Ã£o</div><div class="stat-value">${nat}</div></div>
      <div class="stat-card green"><div class="stat-label">RNM / RNE</div><div class="stat-value">${rnm}</div></div>
      <div class="stat-card red"><div class="stat-label">Visto EUA</div><div class="stat-value">${visto}</div></div>
    </div>

    <div class="panel" style="margin-bottom:24px">
      <div class="panel-header">
        <span class="panel-title">RelatÃ³rio de Processos por ServiÃ§o</span>
        <button class="btn btn-outline btn-sm" onclick="alert('Exportando para PDF...')">ğŸ“„ Exportar PDF</button>
      </div>
      <div class="panel-body">
        ${[['ğŸ‡§ğŸ‡· NaturalizaÃ§Ã£o Brasileira', nat, clientes.filter(c=>c.servico.includes('NaturalizaÃ§Ã£o')&&c.status==='ConcluÃ­do').length],
           ['ğŸªª AutorizaÃ§Ã£o ResidÃªncia RNM', rnm, clientes.filter(c=>c.servico.includes('RNM')&&c.status==='ConcluÃ­do').length],
           ['âœˆï¸ Visto de Turismo EUA', visto, clientes.filter(c=>c.servico.includes('Visto')&&c.status==='ConcluÃ­do').length]].map(([s,t,c])=>`
          <div style="margin-bottom:20px">
            <div style="display:flex;justify-content:space-between;margin-bottom:8px">
              <span style="font-size:0.85rem;font-weight:500">${s}</span>
              <span style="font-size:0.82rem;color:var(--text3)">${c} concluÃ­dos / ${t} total</span>
            </div>
            <div class="progress-bar"><div class="progress-fill" style="width:${t>0?Math.round(c/t*100):0}%"></div></div>
          </div>`).join('')}
      </div>
    </div>

    <div class="panel">
      <div class="panel-header"><span class="panel-title">Desempenho por Colaborador</span></div>
      <div class="panel-body" style="padding:0">
        <table class="tbl">
          <thead><tr><th>Colaborador</th><th>Processos Ativos</th><th>ConcluÃ­dos</th><th>Clientes</th></tr></thead>
          <tbody>
            <tr>
              <td><strong style="color:var(--text)">Fernanda Costa</strong></td>
              <td><span class="badge badge-blue">3</span></td>
              <td><span class="badge badge-green">2</span></td>
              <td>6</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  `;
}

// â”€â”€â”€ COLABORADORES â”€â”€â”€
function renderColaboradores() {
  return `
    <div style="display:flex;gap:12px;margin-bottom:24px">
      <button class="btn btn-gold" onclick="openNovoColaborador()">+ Novo Colaborador</button>
    </div>
    <div class="grid-2">
      <div class="panel">
        <div class="panel-header"><span class="panel-title">Equipe Ativa</span></div>
        <div class="panel-body">
          <div style="display:flex;flex-direction:column;gap:16px">
            ${[{n:'Fernanda Costa',cargo:'Analista de Processos',email:'fernanda@wbassessoria.com.br',processos:6,av:'FC'},
               {n:'Ricardo Nunes',cargo:'Consultor JurÃ­dico',email:'ricardo@wbassessoria.com.br',processos:0,av:'RN'},
               {n:'William Borges',cargo:'CEO / Diretor',email:'ceo@wbassessoria.com.br',processos:0,av:'WB'}].map(c=>`
              <div style="display:flex;align-items:center;gap:14px;background:var(--navy4);border-radius:12px;padding:14px">
                <div class="user-avatar" style="width:48px;height:48px;font-size:0.9rem">${c.av}</div>
                <div style="flex:1">
                  <div style="font-weight:600;color:var(--text)">${c.n}</div>
                  <div style="font-size:0.75rem;color:var(--text3)">${c.cargo}</div>
                  <div style="font-size:0.72rem;color:var(--text3);margin-top:2px">${c.email}</div>
                </div>
                <div style="text-align:center">
                  <div style="font-family:'Cormorant Garamond',serif;font-size:1.5rem;font-weight:700;color:var(--gold)">${c.processos}</div>
                  <div style="font-size:0.65rem;color:var(--text3)">processos</div>
                </div>
              </div>`).join('')}
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header"><span class="panel-title">PermissÃµes de Acesso</span></div>
        <div class="panel-body">
          <table class="tbl">
            <thead><tr><th>MÃ³dulo</th><th>Colaborador</th><th>CEO</th></tr></thead>
            <tbody>
              ${[['Clientes','âœ…','âœ…'],['Processos','âœ…','âœ…'],['Financeiro','âŒ','âœ…'],['RelatÃ³rios','âŒ','âœ…'],['Colaboradores','âŒ','âœ…'],['ConfiguraÃ§Ãµes','âŒ','âœ…']].map(([m,col,ceo])=>`
                <tr><td>${m}</td><td style="text-align:center">${col}</td><td style="text-align:center">${ceo}</td></tr>`).join('')}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  `;
}

// â”€â”€â”€ AGENDAMENTOS â”€â”€â”€
function renderAgendamentos() {
  return `
    <div style="display:flex;gap:12px;margin-bottom:24px">
      <button class="btn btn-gold" onclick="openNovoAgendamento()">+ Novo Agendamento</button>
    </div>
    <div class="panel">
      <div class="panel-header"><span class="panel-title">Agenda de ReuniÃµes</span></div>
      <div class="panel-body" style="padding:0">
        <table class="tbl">
          <thead><tr><th>Data</th><th>Hora</th><th>Cliente</th><th>Tipo</th><th>Colaborador</th><th>AÃ§Ãµes</th></tr></thead>
          <tbody>
            ${AGENDAMENTOS.map(a=>`
              <tr>
                <td style="font-family:'DM Mono',monospace;font-size:0.78rem">${a.data}</td>
                <td style="font-family:'DM Mono',monospace;font-size:0.78rem;color:var(--gold)">${a.hora}</td>
                <td style="font-weight:500;color:var(--text)">${a.cliente}</td>
                <td><span class="badge badge-blue">${a.tipo}</span></td>
                <td style="font-size:0.8rem">${a.colaborador}</td>
                <td><button class="btn btn-sm btn-outline">Editar</button></td>
              </tr>`).join('')}
          </tbody>
        </table>
      </div>
    </div>
  `;
}

// â”€â”€â”€ SERVIÃ‡OS â”€â”€â”€
function renderServico(tipo) {
  const configs = {
    nat: {
      title:'NaturalizaÃ§Ã£o Brasileira',
      desc:'Processo de obtenÃ§Ã£o da cidadania brasileira para estrangeiros residentes, nos termos da ConstituiÃ§Ã£o Federal e da Lei de MigraÃ§Ã£o.',
      etapas:[
        { e:'AvaliaÃ§Ã£o de Elegibilidade e Tipo de NaturalizaÃ§Ã£o', art:'Art. 65-68, Lei nÂº 13.445/2017 | Art. 233-237, Dec. nÂº 9.199/2017' },
        { e:'Coleta e AutenticaÃ§Ã£o de DocumentaÃ§Ã£o', art:'Art. 4Âº, Portaria MJ nÂº 623/2020 | Anexos I a IV da Portaria 623/2020' },
        { e:'TraduÃ§Ã£o Juramentada (documentos estrangeiros)', art:'Dec. nÂº 8.660/2016 â€“ ConvenÃ§Ã£o sobre Apostila de Haia | Art. 7Âº, Portaria nÂº 623/2020' },
        { e:'Envio via Plataforma Gov.BR / Naturalizar-se', art:'Art. 3Âº, Portaria MJ nÂº 623/2020 | Art. 219, Dec. nÂº 9.199/2017' },
        { e:'AnÃ¡lise pela PF e DEMIR/SENAJUS', art:'Art. 7Âº, Portaria MJ nÂº 623/2020 | Art. 224-226, Dec. nÂº 9.199/2017' },
        { e:'PublicaÃ§Ã£o no DOU e Cadastro Eleitoral', art:'Art. 12, II, "a", CF/1988 | Art. 230-231, Dec. nÂº 9.199/2017' },
      ],
      modalidades:[
        { tipo:'OrdinÃ¡ria', req:'ResidÃªncia por prazo indeterminado hÃ¡ â‰¥ 4 anos (ou 1 ano se filho BR, cÃ´njuge BR ou CPLP; ou 2 anos por serviÃ§o relevante)', base:'Art. 65, Lei nÂº 13.445/2017 | Art. 233-237, Dec. nÂº 9.199/2017' },
        { tipo:'ExtraordinÃ¡ria', req:'ResidÃªncia ininterrupta no Brasil por +15 anos, sem condenaÃ§Ã£o penal', base:'Art. 67, Lei nÂº 13.445/2017 | Art. 238-239, Dec. nÂº 9.199/2017' },
        { tipo:'Especial', req:'CÃ´njuge/companheiro hÃ¡ +5 anos de integrante do ServiÃ§o Exterior Brasileiro, ou funcionÃ¡rio de missÃ£o diplomÃ¡tica por +10 anos', base:'Art. 68, Lei nÂº 13.445/2017 | Art. 240-241, Dec. nÂº 9.199/2017' },
        { tipo:'ProvisÃ³ria (menor)', req:'CrianÃ§a/adolescente que fixou residÃªncia no Brasil antes dos 10 anos de idade', base:'Art. 70, Lei nÂº 13.445/2017 | Art. 245-247, Dec. nÂº 9.199/2017' },
      ],
      docs:[
        { doc:'Passaporte ou documento de identificaÃ§Ã£o nacional (vÃ¡lido ou vencido)', base:'Anexo I, item 4, Portaria nÂº 623/2020' },
        { doc:'CertidÃ£o de Nascimento ou Casamento (traduzida e apostilada)', base:'Anexo I, item 3, Portaria nÂº 623/2020 | Dec. nÂº 8.660/2016' },
        { doc:'CRNM (Carteira de Registro Nacional MigratÃ³rio) â€“ prazo indeterminado', base:'Art. 65, Lei nÂº 13.445/2017 | Art. 73-74, Dec. nÂº 9.199/2017' },
        { doc:'Comprovante de residÃªncia ininterrupta (Ãºltimos 4 anos)', base:'Art. 65, I, Lei nÂº 13.445/2017 | Art. 56, Portaria nÂº 623/2020' },
        { doc:'CertidÃ£o de Antecedentes Criminais â€“ JustiÃ§a Federal (Ãºltimos 4 anos)', base:'Anexo I, item 8, Portaria nÂº 623/2020' },
        { doc:'CertidÃ£o de Antecedentes Criminais â€“ JustiÃ§a Estadual (Ãºltimos 4 anos)', base:'Anexo I, item 9, Portaria nÂº 623/2020' },
        { doc:'Atestado de Antecedentes do paÃ­s de origem (apostilado + traduÃ§Ã£o juramentada)', base:'Anexo I, item 10, Portaria nÂº 623/2020 | Dec. nÂº 8.660/2016' },
        { doc:'Comprovante de proficiÃªncia em portuguÃªs (CELPE-BRAS ou equivalente)', base:'Art. 5Âº, Portaria nÂº 623/2020 | Art. 234, Dec. nÂº 9.199/2017' },
        { doc:'Fotos 3Ã—4 recentes (fundo branco)', base:'Anexo I, item 2, Portaria nÂº 623/2020' },
        { doc:'FormulÃ¡rio de Requerimento preenchido (plataforma Naturalizar-se / Gov.BR)', base:'Art. 3Âº, Portaria nÂº 623/2020' },
        { doc:'Comprovante de meios de subsistÃªncia (renda, emprego, etc.)', base:'Anexo I, item 11, Portaria nÂº 623/2020' },
        { doc:'DeclaraÃ§Ã£o de continuidade de uniÃ£o, se casado com brasileiro(a)', base:'Anexo I, item 14, Portaria nÂº 623/2020' },
      ],
      legislacoes:[
        { tipo:'CONSTITUIÃ‡ÃƒO', norm:'Art. 12, II, "a" e "b" â€“ CF/1988', desc:'Fundamento constitucional da naturalizaÃ§Ã£o; define quem pode ser brasileiro naturalizado.', url:'https://www.planalto.gov.br/ccivil_03/constituicao/constituicao.htm' },
        { tipo:'LEI', norm:'Lei nÂº 13.445/2017 â€“ Lei de MigraÃ§Ã£o', desc:'Arts. 64-76 regulam a naturalizaÃ§Ã£o ordinÃ¡ria, extraordinÃ¡ria, especial, provisÃ³ria, a perda e reaquisiÃ§Ã£o da nacionalidade.', url:'https://www.planalto.gov.br/ccivil_03/_ato2015-2018/2017/lei/l13445.htm' },
        { tipo:'DECRETO', norm:'Decreto nÂº 9.199/2017', desc:'Arts. 218-254 regulamentam os procedimentos de naturalizaÃ§Ã£o: requisitos, documentaÃ§Ã£o, prazos, recursos e cancelamento.', url:'https://www.planalto.gov.br/ccivil_03/_ato2015-2018/2017/decreto/d9199.htm' },
        { tipo:'PORTARIA', norm:'Portaria MJ nÂº 623/2020', desc:'DispÃµe sobre os procedimentos de naturalizaÃ§Ã£o, delegaÃ§Ã£o de competÃªncias ao DEMIR/SENAJUS, documentaÃ§Ã£o exigida (Anexos I-IV) e tramitaÃ§Ã£o eletrÃ´nica via Gov.BR.', url:'https://www.in.gov.br/en/web/dou/-/portaria-n-623-de-13-de-novembro-de-2020-288547519' },
        { tipo:'DECRETO', norm:'Decreto nÂº 8.660/2016', desc:'Promulga a ConvenÃ§Ã£o de Haia sobre eliminaÃ§Ã£o da exigÃªncia de legalizaÃ§Ã£o de documentos pÃºblicos estrangeiros (Apostila).', url:'https://www.planalto.gov.br/ccivil_03/_ato2015-2018/2016/decreto/d8660.htm' },
        { tipo:'PORTARIA', norm:'Portaria MJ nÂº 218/2018', desc:'Art. 312 do Dec. nÂº 9.199/2017 â€“ regula reaquisiÃ§Ã£o da nacionalidade e revogaÃ§Ã£o de perda.', url:'https://www.in.gov.br/web/guest/materia/-/asset_publisher/Kujrw0TZC2Mb/content/id/4714118' },
        { tipo:'LEI', norm:'Lei nÂº 9.784/1999 â€“ Processo Administrativo Federal', desc:'Art. 53 da Portaria nÂº 623/2020 remete a esta lei para anulaÃ§Ã£o de naturalizaÃ§Ã£o eivada de vÃ­cio de legalidade.', url:'https://www.planalto.gov.br/ccivil_03/leis/l9784.htm' },
      ],
      prazo:'AtÃ© 180 dias (corridos)', taxaGov:'Gratuito (isento)', honorarios:'R$ 3.500 â€“ R$ 5.500', orgao:'DEMIR / SENAJUS / MJ', plataforma:'Gov.BR â€“ Naturalizar-se'
    },
    rnm: {
      title:'AutorizaÃ§Ã£o de ResidÃªncia (RNM/RNE)',
      desc:'Registro Nacional MigratÃ³rio para estrangeiros que desejam residir legal e regularmente no Brasil, substituindo o antigo RNE.',
      etapas:[
        { e:'AnÃ¡lise da situaÃ§Ã£o migratÃ³ria e amparo legal aplicÃ¡vel', art:'Art. 30, Lei nÂº 13.445/2017 | Arts. 127-128, Dec. nÂº 9.199/2017' },
        { e:'Coleta e organizaÃ§Ã£o da documentaÃ§Ã£o', art:'Art. 129, Dec. nÂº 9.199/2017 | RN CNIg nÂº 1/2017' },
        { e:'Protocolo no MigranteWeb (MJSP) ou PolÃ­cia Federal', art:'Art. 128, Dec. nÂº 9.199/2017 | Art. 2Âº, RN CNIg nÂº 1/2017' },
        { e:'AnÃ¡lise pelo CGIL/DEMIG/SENAJUS e publicaÃ§Ã£o no DOU', art:'Art. 130, Dec. nÂº 9.199/2017' },
        { e:'Registro na PolÃ­cia Federal â€“ emissÃ£o da CRNM', art:'Arts. 67-69, Dec. nÂº 9.199/2017 | Art. 30, Lei nÂº 13.445/2017' },
      ],
      modalidades:[
        { tipo:'Laboral', req:'Contrato de trabalho com empresa brasileira ou exercÃ­cio de atividade remunerada no Brasil', base:'Art. 30, I, "e", Lei nÂº 13.445/2017 | Art. 147, Dec. nÂº 9.199/2017' },
        { tipo:'ReuniÃ£o Familiar', req:'Parentesco com brasileiro(a) ou com estrangeiro residente; cÃ´njuge, filho, pai/mÃ£e', base:'Art. 30, II, Lei nÂº 13.445/2017 | Arts. 152-164, Dec. nÂº 9.199/2017' },
        { tipo:'Acolhida HumanitÃ¡ria', req:'Nacional haitiano ou ucraniano; vÃ­tima de desastre natural ou conflito armado', base:'Art. 30, III, Lei nÂº 13.445/2017 | Portarias Interministeriais MJSP/MRE nÂº 49, 50 e 51/2024' },
        { tipo:'Investidor / EmpresÃ¡rio', req:'Investimento mÃ­nimo em empresa brasileira ou abertura de empresa', base:'Art. 30, I, "f", Lei nÂº 13.445/2017 | Res. Norm. CNIg nÂº 13/2017' },
        { tipo:'Pesquisa / Ensino / ExtensÃ£o', req:'VÃ­nculo com instituiÃ§Ã£o de pesquisa ou ensino superior credenciada pelo MEC', base:'Art. 30, I, "d", Lei nÂº 13.445/2017 | Art. 148, Dec. nÂº 9.199/2017' },
      ],
      docs:[
        { doc:'Passaporte vÃ¡lido', base:'Art. 129, I, Dec. nÂº 9.199/2017' },
        { doc:'Visto vÃ¡lido ou documento que comprove ingresso legal no Brasil', base:'Art. 129, II, Dec. nÂº 9.199/2017' },
        { doc:'Comprovante de residÃªncia no Brasil', base:'Art. 129, IV, Dec. nÂº 9.199/2017' },
        { doc:'Comprovante de vÃ­nculo (contrato de trabalho, certidÃ£o casamento, etc.)', base:'Art. 129, V, Dec. nÂº 9.199/2017 | RN CNIg nÂº 1/2017' },
        { doc:'CertidÃ£o de Antecedentes Criminais â€“ PolÃ­cia Federal', base:'Art. 129, VI, Dec. nÂº 9.199/2017' },
        { doc:'CertidÃ£o de Antecedentes Criminais do paÃ­s de origem (apostilada + traduzida)', base:'Art. 129, VI, Dec. nÂº 9.199/2017 | Dec. nÂº 8.660/2016' },
        { doc:'Fotos 3Ã—4 recentes', base:'Art. 129, III, Dec. nÂº 9.199/2017' },
        { doc:'GRU â€“ Guia de Recolhimento da UniÃ£o (taxa R$ 204,77)', base:'Anexo Ã  Lei nÂº 13.445/2017 â€“ Tabela de Taxas' },
        { doc:'FormulÃ¡rio de Requerimento â€“ sistema MigranteWeb / Portal PF', base:'Art. 128, Dec. nÂº 9.199/2017 | Art. 2Âº, RN CNIg nÂº 1/2017' },
      ],
      legislacoes:[
        { tipo:'LEI', norm:'Lei nÂº 13.445/2017 â€“ Lei de MigraÃ§Ã£o', desc:'Arts. 30-33 definem os tipos de AutorizaÃ§Ã£o de ResidÃªncia (por prazo determinado e indeterminado) e as hipÃ³teses de concessÃ£o, cancelamento e perda.', url:'https://www.planalto.gov.br/ccivil_03/_ato2015-2018/2017/lei/l13445.htm' },
        { tipo:'DECRETO', norm:'Decreto nÂº 9.199/2017', desc:'Arts. 127-141 regulamentam o procedimento de concessÃ£o da autorizaÃ§Ã£o, documentaÃ§Ã£o mÃ­nima, prazos, renovaÃ§Ã£o, multas e deportaÃ§Ã£o por irregularidade.', url:'https://www.planalto.gov.br/ccivil_03/_ato2015-2018/2017/decreto/d9199.htm' },
        { tipo:'DECRETO', norm:'Decreto nÂº 9.199/2017 â€“ Arts. 67-76', desc:'Registro Nacional MigratÃ³rio (RNM): procedimento de registro na PolÃ­cia Federal, emissÃ£o da CRNM, biometria e dados biogrÃ¡ficos.', url:'https://www.planalto.gov.br/ccivil_03/_ato2015-2018/2017/decreto/d9199.htm' },
        { tipo:'RESOLUÃ‡ÃƒO', norm:'ResoluÃ§Ã£o Normativa CNIg nÂº 1/2017', desc:'Procedimento geral para requerer a AutorizaÃ§Ã£o de ResidÃªncia: documentaÃ§Ã£o mÃ­nima aplicÃ¡vel a quase todas as modalidades.', url:'https://portaldeimigracao.mj.gov.br/pt/legislacao-do-cnig' },
        { tipo:'PORTARIA', norm:'Portaria MJSP nÂº 666/2021 e atualizaÃ§Ãµes', desc:'Disciplina os procedimentos para a concessÃ£o de autorizaÃ§Ã£o de residÃªncia de competÃªncia do MJSP.', url:'https://portaldeimigracao.mj.gov.br/pt/nova-legislacao' },
        { tipo:'PORTARIA', norm:'Portarias Interministeriais MJSP/MRE nÂº 49, 50 e 51/2024', desc:'ResidÃªncia por Acolhida HumanitÃ¡ria: haitianos, ucranianos e nacionais afetados por calamidades.', url:'https://portaldeimigracao.mj.gov.br/pt/nova-legislacao' },
        { tipo:'LEI', norm:'Lei nÂº 13.445/2017 â€“ Art. 109 | Dec. nÂº 9.199/2017 â€“ Art. 130', desc:'InfraÃ§Ãµes migratÃ³rias: multa por permanÃªncia irregular apÃ³s vencimento da autorizaÃ§Ã£o, e deportaÃ§Ã£o se nÃ£o regularizado no prazo fixado.', url:'https://www.planalto.gov.br/ccivil_03/_ato2015-2018/2017/lei/l13445.htm' },
        { tipo:'DECRETO', norm:'Decreto nÂº 8.660/2016', desc:'ConvenÃ§Ã£o de Haia (Apostila) â€“ para legalizaÃ§Ã£o de documentos estrangeiros apresentados no processo.', url:'https://www.planalto.gov.br/ccivil_03/_ato2015-2018/2016/decreto/d8660.htm' },
      ],
      prazo:'2 a 6 meses (laboral atÃ© 2 meses)', taxaGov:'R$ 204,77 (GRU)', honorarios:'R$ 2.800 â€“ R$ 4.000', orgao:'CGIL / DEMIG / SENAJUS + PolÃ­cia Federal', plataforma:'MigranteWeb â€“ Portal de ImigraÃ§Ã£o MJ'
    },
    visto: {
      title:'Visto de Turismo (EUA) B-1/B-2',
      desc:'Visto nÃ£o-imigrante americano para turismo (B-2), negÃ³cios de curta duraÃ§Ã£o (B-1) ou ambos, com base no Immigration and Nationality Act (INA) dos EUA.',
      etapas:[
        { e:'AvaliaÃ§Ã£o de elegibilidade e perfil do solicitante', art:'INA Â§ 101(a)(15)(B) | 22 CFR Â§ 41.31' },
        { e:'Preenchimento e envio do FormulÃ¡rio DS-160 (online)', art:'22 CFR Â§ 42.67 | State Dept â€“ Consular Electronic Application Center (CEAC)' },
        { e:'Pagamento da Taxa MRV (Machine Readable Visa)', art:'22 CFR Â§ 22.1 â€“ Schedule of Fees for Consular Services | Atualmente US$ 185' },
        { e:'Agendamento de entrevista consular (Embaixada/Consulado EUA no Brasil)', art:'INA Â§ 222(a) | 9 FAM 403.5 â€“ Consular Interview Requirements' },
        { e:'Entrevista com Oficial Consular e decisÃ£o', art:'INA Â§ 222(b) | 22 CFR Â§ 41.102 | 9 FAM 302.1 â€“ Immigrant Intent (presunÃ§Ã£o de imigrante)' },
      ],
      modalidades:[
        { tipo:'B-2 Turismo', req:'Visita turÃ­stica, fÃ©rias, visita a familiares/amigos, tratamento mÃ©dico, participaÃ§Ã£o em torneios amadores', base:'INA Â§ 101(a)(15)(B) | 9 FAM 402.2-4(A)' },
        { tipo:'B-1 NegÃ³cios', req:'ReuniÃµes, conferÃªncias, negociaÃ§Ãµes contratuais, seminÃ¡rios, visitas tÃ©cnicas (sem emprego remunerado nos EUA)', base:'INA Â§ 101(a)(15)(B) | 9 FAM 402.2-4(B)' },
        { tipo:'B-1/B-2 Combinado', req:'CombinaÃ§Ã£o das atividades acima numa mesma viagem', base:'9 FAM 402.2-2 â€“ Combined B-1/B-2 Visa Classification' },
      ],
      docs:[
        { doc:'Passaporte vÃ¡lido por â‰¥ 6 meses alÃ©m da estada pretendida', base:'INA Â§ 212(a)(7)(B)(i) | 9 FAM 302.8-2' },
        { doc:'FormulÃ¡rio DS-160 preenchido e pÃ¡gina de confirmaÃ§Ã£o impressa (com cÃ³digo de barras)', base:'22 CFR Â§ 42.67 | State Dept â€“ CEAC' },
        { doc:'Comprovante de pagamento da Taxa MRV (US$ 185)', base:'22 CFR Â§ 22.1 â€“ Schedule of Fees' },
        { doc:'Foto 5Ã—5 cm (padrÃ£o americano â€“ fundo branco, recente)', base:'State Dept â€“ Photo Requirements for U.S. Visa' },
        { doc:'Comprovante de vÃ­nculos no Brasil: emprego, imÃ³vel, famÃ­lia (comprovam intenÃ§Ã£o de retorno)', base:'INA Â§ 214(b) â€“ PresunÃ§Ã£o de Imigrante | 9 FAM 302.1-2' },
        { doc:'Comprovante de renda e/ou capacidade financeira para custear a viagem', base:'9 FAM 402.2-5(B) â€“ Financial Resources' },
        { doc:'Extratos bancÃ¡rios dos Ãºltimos 3 a 6 meses', base:'9 FAM 402.2-5(B)' },
        { doc:'Comprovante de vÃ­nculo empregatÃ­cio (carta da empresa com salÃ¡rio e cargo)', base:'9 FAM 402.2-5(A)' },
        { doc:'Carta de apresentaÃ§Ã£o (se viagem a negÃ³cios ou custeada por terceiro)', base:'9 FAM 402.2-4(B)' },
        { doc:'Imposto de Renda (IRPF) â€“ Ãºltimo exercÃ­cio', base:'9 FAM 402.2-5(B)' },
      ],
      legislacoes:[
        { tipo:'LEI (EUA)', norm:'Immigration and Nationality Act (INA) â€“ Â§ 101(a)(15)(B)', desc:'Fundamento legal principal do visto B-1/B-2: define "visitante temporÃ¡rio" para negÃ³cios (B-1) e para prazer/turismo (B-2).', url:'https://uscode.house.gov/view.xhtml?req=granuleid:USC-prelim-title8-section1101&num=0&edition=prelim' },
        { tipo:'LEI (EUA)', norm:'INA Â§ 214(b)', desc:'PresunÃ§Ã£o de imigrante: todo solicitante Ã© presumido imigrante atÃ© provar vÃ­nculos suficientes com seu paÃ­s de origem. Base para indeferimentos.', url:'https://uscode.house.gov/view.xhtml?req=granuleid:USC-prelim-title8-section1184&num=0&edition=prelim' },
        { tipo:'LEI (EUA)', norm:'INA Â§ 222(a) e (b)', desc:'Obrigatoriedade de solicitaÃ§Ã£o pessoal, preenchimento de formulÃ¡rio e entrevista consular para obtenÃ§Ã£o de visto.', url:'https://uscode.house.gov/view.xhtml?req=granuleid:USC-prelim-title8-section1202&num=0&edition=prelim' },
        { tipo:'REGULAMENTO (EUA)', norm:'22 CFR Part 41 â€“ Vistos de NÃ£o-Imigrantes', desc:'CÃ³digo de Regulamentos Federais dos EUA: Â§ 41.31 trata especificamente da classificaÃ§Ã£o B-1/B-2 e requisitos de admissibilidade.', url:'https://www.ecfr.gov/current/title-22/chapter-I/subchapter-E/part-41' },
        { tipo:'REGULAMENTO (EUA)', norm:'22 CFR Â§ 22.1 â€“ Schedule of Fees', desc:'Define o valor da taxa MRV (Machine Readable Visa fee), atualmente US$ 185, cobrada para todos os vistos nÃ£o-imigrantes.', url:'https://www.ecfr.gov/current/title-22/chapter-I/subchapter-A/part-22' },
        { tipo:'MANUAL (EUA)', norm:'Foreign Affairs Manual â€“ 9 FAM 402.2', desc:'Manual do Departamento de Estado dos EUA: detalha como os oficiais consulares devem avaliar os vistos B-1/B-2, incluindo critÃ©rios de vÃ­nculos, recursos financeiros e finalidade da viagem.', url:'https://fam.state.gov/fam/09FAM/09FAM040202.html' },
        { tipo:'MANUAL (EUA)', norm:'9 FAM 302.1 â€“ Immigrant Intent', desc:'OrientaÃ§Ãµes sobre a presunÃ§Ã£o de intenÃ§Ã£o de imigrar (INA Â§ 214(b)) e como o solicitante pode refutÃ¡-la apresentando vÃ­nculos com seu paÃ­s de origem.', url:'https://fam.state.gov/fam/09FAM/09FAM030201.html' },
        { tipo:'FORMULÃRIO', norm:'FormulÃ¡rio DS-160 â€“ Online Nonimmigrant Visa Application', desc:'FormulÃ¡rio eletrÃ´nico obrigatÃ³rio para todos os solicitantes de visto nÃ£o-imigrante. Submetido via Consular Electronic Application Center (CEAC).', url:'https://ceac.state.gov/genniv/' },
      ],
      prazo:'1 a 6 meses (varia por consulado)', taxaGov:'US$ 185 (taxa MRV)', honorarios:'R$ 2.000 â€“ R$ 3.500', orgao:'U.S. Embassy/Consulate in Brazil â€“ Dept. of State', plataforma:'CEAC â€“ ceac.state.gov + usvisa-info.com (agendamento)'
    }
  };
  const s = configs[tipo];
  const related = clientes.filter(c=>c.servico.includes(s.title.split('(')[0].trim().split(' ').slice(0,2).join(' ')));

  const tipoColors = { 'CONSTITUIÃ‡ÃƒO':'#a78bfa', 'LEI':'#60a5fa', 'LEI (EUA)':'#60a5fa', 'DECRETO':'#34d399', 'PORTARIA':'#f59e0b', 'RESOLUÃ‡ÃƒO':'#fb923c', 'REGULAMENTO (EUA)':'#34d399', 'MANUAL (EUA)':'#c084fc', 'FORMULÃRIO':'#f59e0b' };

  return `
    <div class="client-header" style="margin-bottom:24px">
      <div class="client-name">${s.title}</div>
      <div class="client-process">${s.desc}</div>
      <div style="display:flex;gap:20px;margin-top:20px;flex-wrap:wrap">
        <div><div style="font-size:0.65rem;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3)">Prazo Estimado</div><div style="color:var(--gold);font-weight:600;margin-top:4px;font-size:0.9rem">${s.prazo}</div></div>
        <div><div style="font-size:0.65rem;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3)">Taxa Gov.</div><div style="color:var(--gold);font-weight:600;margin-top:4px;font-size:0.9rem">${s.taxaGov}</div></div>
        <div><div style="font-size:0.65rem;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3)">HonorÃ¡rios WB</div><div style="color:var(--gold);font-weight:600;margin-top:4px;font-size:0.9rem">${s.honorarios}</div></div>
        <div><div style="font-size:0.65rem;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3)">Ã“rgÃ£o Competente</div><div style="color:var(--text2);font-weight:500;margin-top:4px;font-size:0.82rem">${s.orgao}</div></div>
        <div><div style="font-size:0.65rem;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3)">Plataforma</div><div style="color:var(--text2);font-weight:500;margin-top:4px;font-size:0.82rem">${s.plataforma}</div></div>
      </div>
    </div>

    <!-- BASE LEGAL -->
    <div class="panel" style="margin-bottom:24px;border-color:rgba(201,168,76,0.3)">
      <div class="panel-header" style="background:rgba(201,168,76,0.05)">
        <span class="panel-title" style="color:var(--gold)">âš–ï¸ Base Legal â€” LegislaÃ§Ã£o AplicÃ¡vel</span>
        <span style="font-size:0.72rem;color:var(--text3)">${s.legislacoes.length} normas aplicÃ¡veis</span>
      </div>
      <div class="panel-body" style="display:flex;flex-direction:column;gap:0">
        ${s.legislacoes.map((l,i)=>`
          <div style="display:flex;align-items:flex-start;gap:14px;padding:14px 0;border-bottom:${i<s.legislacoes.length-1?'1px solid var(--border2)':'none'}">
            <div style="flex-shrink:0;padding:4px 8px;border-radius:6px;font-size:0.62rem;font-weight:700;letter-spacing:1px;background:rgba(${tipoColors[l.tipo]?'255,255,255':'255,255,255'},0.05);color:${tipoColors[l.tipo]||'var(--text3)'};border:1px solid ${tipoColors[l.tipo]||'var(--border2)'};white-space:nowrap">${l.tipo}</div>
            <div style="flex:1">
              <div style="font-size:0.85rem;font-weight:600;color:var(--text);margin-bottom:3px">${l.norm}</div>
              <div style="font-size:0.78rem;color:var(--text3);line-height:1.5">${l.desc}</div>
            </div>
            <a href="${l.url}" target="_blank" style="flex-shrink:0;color:var(--gold);font-size:0.72rem;text-decoration:none;padding:4px 8px;border:1px solid var(--border);border-radius:6px;white-space:nowrap;transition:all 0.2s" onmouseover="this.style.background='rgba(201,168,76,0.1)'" onmouseout="this.style.background='transparent'">ğŸ”— Ver lei</a>
          </div>`).join('')}
      </div>
    </div>

    <!-- MODALIDADES -->
    <div class="panel" style="margin-bottom:24px">
      <div class="panel-header"><span class="panel-title">ğŸ“Œ Modalidades de ${tipo==='nat'?'NaturalizaÃ§Ã£o':tipo==='rnm'?'AutorizaÃ§Ã£o de ResidÃªncia':'Visto B-1/B-2'}</span></div>
      <div class="panel-body" style="display:flex;flex-direction:column;gap:12px">
        ${s.modalidades.map(m=>`
          <div style="background:var(--navy4);border-radius:12px;padding:16px;border-left:3px solid var(--gold)">
            <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap;margin-bottom:8px">
              <span style="font-size:0.88rem;font-weight:700;color:var(--gold)">${m.tipo}</span>
              <span style="font-size:0.68rem;color:var(--text3);font-family:'DM Mono',monospace;background:var(--navy2);padding:3px 8px;border-radius:5px">${m.base}</span>
            </div>
            <div style="font-size:0.8rem;color:var(--text2)">${m.req}</div>
          </div>`).join('')}
      </div>
    </div>

    <div class="grid-2" style="margin-bottom:24px">
      <!-- ETAPAS -->
      <div class="panel">
        <div class="panel-header"><span class="panel-title">ğŸ—‚ï¸ Etapas do Processo c/ Fundamento Legal</span></div>
        <div class="panel-body">
          <div class="timeline">
            ${s.etapas.map((e,i)=>`
              <div class="timeline-item" style="padding-bottom:22px">
                <div class="timeline-dot ${i<2?'done':i===2?'active':''}"></div>
                <div class="timeline-text" style="font-weight:600;color:var(--text)">${e.e}</div>
                <div style="margin-top:5px;font-size:0.7rem;color:var(--gold);font-family:'DM Mono',monospace;background:rgba(201,168,76,0.06);border-radius:5px;padding:4px 8px;display:inline-block">${e.art}</div>
              </div>`).join('')}
          </div>
        </div>
      </div>

      <!-- DOCUMENTAÃ‡ÃƒO -->
      <div class="panel">
        <div class="panel-header"><span class="panel-title">ğŸ“‹ DocumentaÃ§Ã£o NecessÃ¡ria c/ Base Legal</span></div>
        <div class="panel-body" style="padding:0">
          ${s.docs.map((d,i)=>`
            <div style="display:flex;align-items:flex-start;gap:10px;padding:12px 16px;border-bottom:${i<s.docs.length-1?'1px solid var(--border2)':'none'}">
              <div class="check-box" onclick="this.classList.toggle('checked');this.textContent=this.classList.contains('checked')?'âœ“':''" style="flex-shrink:0;margin-top:2px"></div>
              <div style="flex:1">
                <div style="font-size:0.82rem;color:var(--text2)">${d.doc}</div>
                <div style="font-size:0.68rem;color:var(--gold);font-family:'DM Mono',monospace;margin-top:3px">${d.base}</div>
              </div>
            </div>`).join('')}
        </div>
      </div>
    </div>

    <!-- CLIENTES -->
    <div class="panel">
      <div class="panel-header"><span class="panel-title">ğŸ‘¥ Clientes neste ServiÃ§o (${related.length})</span></div>
      <div style="padding:0">${tabelaClientes(related)}</div>
    </div>
  `;
}

// â”€â”€â”€ CONFIGURAÃ‡Ã•ES â”€â”€â”€
function renderConfiguracoes() {
  return `
    <div class="grid-2">
      <div class="panel">
        <div class="panel-header"><span class="panel-title">Dados da Empresa</span></div>
        <div class="panel-body">
          <div class="form-grid">
            <div class="form-field form-full"><label>RazÃ£o Social</label><input value="WB Assessoria MigratÃ³ria LTDA"></div>
            <div class="form-field"><label>CNPJ</label><input value="XX.XXX.XXX/0001-XX"></div>
            <div class="form-field"><label>Telefone</label><input value="(11) 9 9999-9999"></div>
            <div class="form-field form-full"><label>E-mail Comercial</label><input value="contato@wbassessoria.com.br"></div>
            <div class="form-field form-full"><label>EndereÃ§o</label><input value="Av. Paulista, 1000 - SÃ£o Paulo, SP"></div>
          </div>
          <div style="margin-top:20px;display:flex;justify-content:flex-end">
            <button class="btn btn-gold" onclick="alert('Dados salvos!')">Salvar AlteraÃ§Ãµes</button>
          </div>
        </div>
      </div>
      <div class="panel">
        <div class="panel-header"><span class="panel-title">NotificaÃ§Ãµes</span></div>
        <div class="panel-body">
          ${[['E-mail para novos clientes','on'],['Alerta de documentos pendentes','on'],['RelatÃ³rio semanal','off'],['SMS para agendamentos','on']].map(([n,s])=>`
            <div style="display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid var(--border2)">
              <span style="font-size:0.85rem;color:var(--text2)">${n}</span>
              <div onclick="this.dataset.on=this.dataset.on==='1'?'0':'1';this.style.background=this.dataset.on==='1'?'var(--gold)':'var(--navy4)'" data-on="${s==='on'?1:0}"
                style="width:40px;height:22px;border-radius:11px;background:${s==='on'?'var(--gold)':'var(--navy4)'};border:1px solid var(--border);cursor:pointer;transition:all 0.2s"></div>
            </div>`).join('')}
        </div>
      </div>
    </div>
  `;
}

// â”€â”€â”€ CLIENTE: MEU PROCESSO â”€â”€â”€
function renderMeuProcesso() {
  const c = clientes[0]; // Ana Souza
  const pct = Math.round(c.etapa/c.totalEtapas*100);
  const etapasNat = ['VerificaÃ§Ã£o de Elegibilidade','Coleta de DocumentaÃ§Ã£o','TraduÃ§Ã£o e AutenticaÃ§Ã£o','Protocolo no MinistÃ©rio','AnÃ¡lise Federal','PublicaÃ§Ã£o DOU'];
  return `
    <div class="client-header">
      <div class="client-name">OlÃ¡, ${c.nome.split(' ')[0]}!</div>
      <div class="client-process">Acompanhe seu processo em tempo real</div>
      <div style="margin-top:20px">
        <div style="display:flex;justify-content:space-between;margin-bottom:8px;font-size:0.82rem">
          <span style="color:var(--text3)">${c.servico}</span>
          <span style="color:var(--gold);font-weight:600">${pct}% concluÃ­do</span>
        </div>
        <div class="progress-bar" style="height:10px"><div class="progress-fill" style="width:${pct}%"></div></div>
      </div>
    </div>

    <div class="grid-2">
      <div class="panel">
        <div class="panel-header"><span class="panel-title">Etapas do Processo</span></div>
        <div class="panel-body">
          <div class="timeline">
            ${etapasNat.map((e,i)=>`
              <div class="timeline-item">
                <div class="timeline-dot ${i<c.etapa?'done':i===c.etapa?'active':''}"></div>
                <div class="timeline-text">${e}</div>
                <div class="timeline-date">${i<c.etapa?'ConcluÃ­da':i===c.etapa?'Em andamento':'Aguardando'}</div>
              </div>`).join('')}
          </div>
        </div>
      </div>

      <div style="display:flex;flex-direction:column;gap:20px">
        <div class="panel">
          <div class="panel-header"><span class="panel-title">Documentos Pendentes</span></div>
          <div class="panel-body">
            ${c.docsPendentes.map(d=>`
              <div class="checklist-item">
                <div class="check-box"></div>
                <span class="check-label">${d}</span>
              </div>`).join('')}
            ${c.docsPendentes.length===0?'<div style="color:var(--green);font-size:0.85rem">âœ… Todos os documentos entregues!</div>':''}
          </div>
        </div>

        <div class="panel">
          <div class="panel-header"><span class="panel-title">InformaÃ§Ãµes do Processo</span></div>
          <div class="panel-body">
            <div style="display:flex;flex-direction:column;gap:10px">
              ${[['ServiÃ§o',c.servico],['ResponsÃ¡vel',c.responsavel],['Status',c.status],['Pagamento',c.pago?'âœ… Pago':'âš ï¸ Pendente']].map(([k,v])=>`
                <div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border2);font-size:0.82rem">
                  <span style="color:var(--text3)">${k}</span><span style="color:var(--text);font-weight:500">${v}</span>
                </div>`).join('')}
            </div>
          </div>
        </div>
      </div>
    </div>
  `;
}

// â”€â”€â”€ CLIENTE: DOCUMENTOS â”€â”€â”€
function renderMeusDocumentos() {
  const c = clientes[0];
  return `
    <div class="panel" style="margin-bottom:24px">
      <div class="panel-header"><span class="panel-title">Documentos Enviados</span></div>
      <div class="panel-body">
        ${c.docs.map(d=>`
          <div class="checklist-item">
            <div class="check-box checked" style="background:var(--gold);border-color:var(--gold)">âœ“</div>
            <span class="check-label">${d}</span>
            <span class="badge badge-green">Recebido</span>
          </div>`).join('')}
      </div>
    </div>

    <div class="panel">
      <div class="panel-header"><span class="panel-title">Documentos Pendentes</span></div>
      <div class="panel-body">
        ${c.docsPendentes.map(d=>`
          <div class="checklist-item">
            <div class="check-box"></div>
            <span class="check-label">${d}</span>
            <button class="btn btn-outline btn-sm" onclick="alert('Selecione o arquivo para enviar: '+event.currentTarget.closest('.checklist-item').querySelector('.check-label').textContent)">ğŸ“ Enviar</button>
          </div>`).join('')}
        <div style="margin-top:20px;padding:20px;background:var(--navy4);border-radius:12px;border:1px dashed var(--border);text-align:center;color:var(--text3);cursor:pointer" onclick="alert('Ãrea de upload de documentos')">
          <div style="font-size:1.5rem;margin-bottom:8px">ğŸ“</div>
          <div style="font-size:0.82rem">Arraste arquivos ou clique para enviar</div>
          <div style="font-size:0.72rem;margin-top:4px">PDF, JPG, PNG â€” mÃ¡x. 10MB</div>
        </div>
      </div>
    </div>
  `;
}

// â”€â”€â”€ CLIENTE: MENSAGENS â”€â”€â”€
function renderMensagensCliente() {
  return `
    <div class="panel" style="height:calc(100vh - 200px);display:flex;flex-direction:column">
      <div class="panel-header"><span class="panel-title">Chat com Equipe WB</span></div>
      <div id="msg-box" style="flex:1;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:12px">
        <div class="msg-item">
          <div class="msg-header"><span class="msg-from">Fernanda Costa</span><span class="msg-time">25/02 Ã s 10:15</span></div>
          <div class="msg-text">Bom dia, Ana! Seu processo estÃ¡ em andamento. Precisamos que vocÃª nos envie o Comprovante de ResidÃªncia dos Ãºltimos 5 anos o quanto antes.</div>
        </div>
        <div class="msg-item" style="background:rgba(201,168,76,0.08);border:1px solid var(--border)">
          <div class="msg-header"><span class="msg-from" style="color:var(--text)">VocÃª</span><span class="msg-time">25/02 Ã s 10:45</span></div>
          <div class="msg-text">Bom dia! Entendido. Vou providenciar. Estimo entregar atÃ© sexta-feira. Precisam de algo mais?</div>
        </div>
        <div class="msg-item">
          <div class="msg-header"><span class="msg-from">Fernanda Costa</span><span class="msg-time">25/02 Ã s 11:00</span></div>
          <div class="msg-text">Perfeito! Por ora sÃ³ isso. Qualquer dÃºvida estarei Ã  disposiÃ§Ã£o. ğŸ˜Š</div>
        </div>
      </div>
      <div style="padding:16px;border-top:1px solid var(--border2);display:flex;gap:12px">
        <input id="msg-input" type="text" placeholder="Digite sua mensagem..." style="flex:1;background:var(--navy2);border:1px solid var(--border2);border-radius:10px;padding:12px 16px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:0.85rem;outline:none">
        <button class="btn btn-gold" onclick="sendMsg()">Enviar</button>
      </div>
    </div>
  `;
}

function sendMsg() {
  const inp = document.getElementById('msg-input');
  const v = inp.value.trim();
  if (!v) return;
  const box = document.getElementById('msg-box');
  const now = new Date();
  const t = now.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'});
  box.innerHTML += `<div class="msg-item" style="background:rgba(201,168,76,0.08);border:1px solid var(--border)"><div class="msg-header"><span class="msg-from" style="color:var(--text)">VocÃª</span><span class="msg-time">Agora Ã s ${t}</span></div><div class="msg-text">${v}</div></div>`;
  inp.value = '';
  box.scrollTop = box.scrollHeight;
}

// â”€â”€â”€ CLIENTE: AGENDAMENTOS â”€â”€â”€
function renderAgendamentosCliente() {
  const meus = AGENDAMENTOS.slice(0,2);
  return `
    <div class="panel">
      <div class="panel-header">
        <span class="panel-title">Meus Agendamentos</span>
        <button class="btn btn-gold btn-sm" onclick="alert('Solicitar novo agendamento')">+ Solicitar ReuniÃ£o</button>
      </div>
      <div class="panel-body" style="padding:0">
        <table class="tbl">
          <thead><tr><th>Data</th><th>Hora</th><th>Tipo</th><th>Colaborador</th></tr></thead>
          <tbody>
            ${meus.map(a=>`
              <tr>
                <td style="font-family:'DM Mono',monospace;font-size:0.78rem">${a.data}</td>
                <td style="font-family:'DM Mono',monospace;font-size:0.78rem;color:var(--gold)">${a.hora}</td>
                <td><span class="badge badge-blue">${a.tipo}</span></td>
                <td style="font-size:0.8rem">${a.colaborador}</td>
              </tr>`).join('')}
          </tbody>
        </table>
      </div>
    </div>
  `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODALS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openModal(html) {
  document.getElementById('modal-body').innerHTML = html;
  document.getElementById('modal').classList.add('open');
}
function closeModal() { document.getElementById('modal').classList.remove('open'); }

function openClienteModal(id) {
  const c = clientes.find(x=>x.id===id);
  if (!c) return;
  const pct = Math.round(c.etapa/c.totalEtapas*100);
  const etapas = {
    'NaturalizaÃ§Ã£o Brasileira':['VerificaÃ§Ã£o Elegibilidade','Coleta Docs','TraduÃ§Ã£o','Protocolo MJ','AnÃ¡lise Federal','PublicaÃ§Ã£o DOU'],
    'AutorizaÃ§Ã£o de ResidÃªncia (RNM)':['AnÃ¡lise MigratÃ³ria','Coleta Docs','Agendamento PF','Atendimento','EmissÃ£o RNM'],
    'Visto de Turismo (EUA)':['AvaliaÃ§Ã£o','DS-160','Pagamento MRV','Agendamento','Entrevista'],
  };
  const etapaList = Object.keys(etapas).find(k=>c.servico.includes(k.split(' ')[0])) ? etapas[Object.keys(etapas).find(k=>c.servico.includes(k.split(' ')[0]))] : ['Etapa 1','Etapa 2','Etapa 3'];

  openModal(`
    <div class="modal-title">${c.nome}</div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:20px">
      ${statusBadge(c.status)} ${servicoBadge(c.servico)} ${c.pago?'<span class="badge badge-green">âœ“ Pago</span>':'<span class="badge badge-red">Pendente</span>'}
    </div>

    <div class="divider-text">InformaÃ§Ãµes</div>
    <div class="form-grid" style="margin-bottom:16px">
      ${[['Email',c.email],['Telefone',c.tel],['PaÃ­s de Origem',c.pais],['ResponsÃ¡vel',c.responsavel],['Cadastro',c.dataCadastro],['Valor',`R$ ${c.valor.toLocaleString('pt-BR')}`]].map(([k,v])=>`
        <div class="form-field"><label>${k}</label><input value="${v}" readonly style="background:var(--navy)"></div>`).join('')}
    </div>

    <div class="divider-text">Progresso</div>
    <div style="margin-bottom:8px;display:flex;justify-content:space-between;font-size:0.82rem"><span style="color:var(--text3)">Etapa ${c.etapa} de ${c.totalEtapas}</span><span style="color:var(--gold)">${pct}%</span></div>
    <div class="progress-bar" style="height:8px;margin-bottom:16px"><div class="progress-fill" style="width:${pct}%"></div></div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px">
      ${etapaList.map((e,i)=>`<span class="badge ${i<c.etapa?'badge-green':i===c.etapa?'badge-blue':'badge-gray'}">${e}</span>`).join('')}
    </div>

    ${c.docsPendentes.length>0?`<div class="divider-text">Docs Pendentes</div>
    <div style="margin-bottom:16px">
      ${c.docsPendentes.map(d=>`<div style="padding:8px 0;border-bottom:1px solid var(--border2);font-size:0.82rem;color:var(--orange)">âš ï¸ ${d}</div>`).join('')}
    </div>`:''}

    ${c.obs?`<div class="divider-text">ObservaÃ§Ãµes</div><div style="background:var(--navy);border-radius:8px;padding:12px;font-size:0.82rem;color:var(--text2);margin-bottom:16px">${c.obs}</div>`:''}

    <div class="modal-actions">
      ${currentRole !== 'cliente' ? `<button class="btn btn-gold" onclick="atualizarEtapa(${c.id})">AvanÃ§ar Etapa</button>` : ''}
      <button class="btn btn-outline" onclick="closeModal()">Fechar</button>
    </div>
  `);
}

function atualizarEtapa(id) {
  const c = clientes.find(x=>x.id===id);
  if (c && c.etapa < c.totalEtapas) {
    c.etapa++;
    if (c.etapa >= c.totalEtapas) c.status = 'ConcluÃ­do';
    closeModal();
    openClienteModal(id);
    navigateTo(currentPage);
  } else {
    alert('Processo jÃ¡ concluÃ­do!');
  }
}

function openNovoCliente() {
  openModal(`
    <div class="modal-title">Novo Cliente</div>
    <div class="form-grid">
      <div class="form-field form-full"><label>Nome Completo</label><input placeholder="Nome do cliente"></div>
      <div class="form-field"><label>E-mail</label><input type="email" placeholder="email@email.com"></div>
      <div class="form-field"><label>Telefone</label><input placeholder="(XX) 9 XXXX-XXXX"></div>
      <div class="form-field"><label>CPF/Passaporte</label><input placeholder="Documento de IdentificaÃ§Ã£o"></div>
      <div class="form-field"><label>PaÃ­s de Origem</label><input placeholder="PaÃ­s"></div>
      <div class="form-field"><label>ServiÃ§o</label>
        <select>
          <option>NaturalizaÃ§Ã£o Brasileira</option>
          <option>AutorizaÃ§Ã£o de ResidÃªncia (RNM)</option>
          <option>Visto de Turismo (EUA)</option>
        </select>
      </div>
      <div class="form-field"><label>ResponsÃ¡vel</label><select><option>Fernanda Costa</option><option>Ricardo Nunes</option></select></div>
      <div class="form-field"><label>Valor (R$)</label><input type="number" placeholder="0,00"></div>
      <div class="form-field form-full"><label>ObservaÃ§Ãµes</label><textarea placeholder="ObservaÃ§Ãµes sobre o cliente..."></textarea></div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-gold" onclick="alert('Cliente cadastrado com sucesso!');closeModal()">Cadastrar</button>
      <button class="btn btn-outline" onclick="closeModal()">Cancelar</button>
    </div>
  `);
}

function openNovaTarefa() {
  openModal(`
    <div class="modal-title">Nova Tarefa</div>
    <div class="form-grid">
      <div class="form-field form-full"><label>TÃ­tulo</label><input placeholder="DescriÃ§Ã£o da tarefa"></div>
      <div class="form-field"><label>Cliente</label>
        <select>${clientes.map(c=>`<option>${c.nome}</option>`).join('')}</select>
      </div>
      <div class="form-field"><label>Prioridade</label><select><option>alta</option><option>normal</option><option>baixa</option></select></div>
      <div class="form-field"><label>Prazo</label><input type="date"></div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-gold" onclick="alert('Tarefa criada!');closeModal()">Criar Tarefa</button>
      <button class="btn btn-outline" onclick="closeModal()">Cancelar</button>
    </div>
  `);
}

function openNovoAgendamento() {
  openModal(`
    <div class="modal-title">Novo Agendamento</div>
    <div class="form-grid">
      <div class="form-field"><label>Data</label><input type="date"></div>
      <div class="form-field"><label>Hora</label><input type="time"></div>
      <div class="form-field"><label>Cliente</label><select>${clientes.map(c=>`<option>${c.nome}</option>`).join('')}</select></div>
      <div class="form-field"><label>Tipo</label><select><option>Consulta Inicial</option><option>Entrega de Documentos</option><option>AtualizaÃ§Ã£o de Processo</option><option>Entrevista PreparatÃ³ria</option></select></div>
      <div class="form-field form-full"><label>ObservaÃ§Ãµes</label><textarea placeholder="Notas para o agendamento..."></textarea></div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-gold" onclick="alert('Agendamento criado!');closeModal()">Agendar</button>
      <button class="btn btn-outline" onclick="closeModal()">Cancelar</button>
    </div>
  `);
}

function openNovoColaborador() {
  openModal(`
    <div class="modal-title">Novo Colaborador</div>
    <div class="form-grid">
      <div class="form-field form-full"><label>Nome Completo</label><input placeholder="Nome"></div>
      <div class="form-field"><label>E-mail</label><input type="email"></div>
      <div class="form-field"><label>Cargo</label><input placeholder="Ex: Analista de Processos"></div>
      <div class="form-field"><label>Acesso</label><select><option>colaborador</option><option>ceo</option></select></div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-gold" onclick="alert('Colaborador cadastrado!');closeModal()">Cadastrar</button>
      <button class="btn btn-outline" onclick="closeModal()">Cancelar</button>
    </div>
  `);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function statusBadge(s) {
  const m = {
    'Em andamento':'badge-blue',
    'ConcluÃ­do':'badge-green',
    'Pendente DocumentaÃ§Ã£o':'badge-orange',
    'Cancelado':'badge-red'
  };
  return `<span class="badge ${m[s]||'badge-gray'}">${s}</span>`;
}

function servicoBadge(s) {
  if (s.includes('Naturaliz')) return `<span class="badge badge-gold">ğŸ‡§ğŸ‡· NaturalizaÃ§Ã£o</span>`;
  if (s.includes('RNM')) return `<span class="badge badge-blue">ğŸªª RNM/RNE</span>`;
  if (s.includes('Visto')) return `<span class="badge badge-green">âœˆï¸ Visto EUA</span>`;
  return `<span class="badge badge-gray">${s}</span>`;
}

function tarefaStatusBadge(s) {
  const m = { pendente:'badge-orange', andamento:'badge-blue', concluida:'badge-green' };
  const l = { pendente:'Pendente', andamento:'Em andamento', concluida:'ConcluÃ­da' };
  return `<span class="badge ${m[s]}">${l[s]}</span>`;
}

function avanÃ§arTarefa(i) {
  const ordem = ['pendente','andamento','concluida'];
  const t = tarefas[i];
  const idx = ordem.indexOf(t.status);
  if (idx < ordem.length-1) { t.status = ordem[idx+1]; renderPage('tarefas'); }
}

function toggleNotif() {
  document.getElementById('notif-panel').classList.toggle('open');
}

document.addEventListener('click', e => {
  const panel = document.getElementById('notif-panel');
  if (panel && !panel.contains(e.target) && !e.target.closest('.notif-btn')) {
    panel.classList.remove('open');
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ§® CALCULADORA DE ELEGIBILIDADE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderCalculadora() {
  return `
    <div style="max-width:760px;margin:0 auto">
      <div class="client-header" style="margin-bottom:28px;text-align:center">
        <div class="client-name">ğŸ§® Calculadora de Elegibilidade</div>
        <div class="client-process">Responda as perguntas abaixo para descobrir qual serviÃ§o se aplica ao seu caso</div>
      </div>

      <div class="panel" style="margin-bottom:20px">
        <div class="panel-header"><span class="panel-title">Perfil do Solicitante</span></div>
        <div class="panel-body">
          <div class="form-grid">
            <div class="form-field">
              <label>Nacionalidade</label>
              <select id="calc-nac" onchange="calcUpdate()">
                <option value="">â€” selecione â€”</option>
                <option value="br">Brasileiro(a) nato/a</option>
                <option value="pt">PortuguÃªs(a)</option>
                <option value="cplp">PaÃ­s CPLP (Angola, Cabo Verde, MoÃ§ambique, etc.)</option>
                <option value="mercosul">Mercosul (Argentina, Uruguai, Paraguai, etc.)</option>
                <option value="outro">Outra nacionalidade</option>
              </select>
            </div>
            <div class="form-field">
              <label>Objetivo</label>
              <select id="calc-obj" onchange="calcUpdate()">
                <option value="">â€” selecione â€”</option>
                <option value="nat">Obter cidadania/passaporte brasileiro</option>
                <option value="residir">Residir legalmente no Brasil</option>
                <option value="visto">Viajar para os Estados Unidos</option>
                <option value="trabalho">Trabalhar no Brasil</option>
              </select>
            </div>
            <div class="form-field">
              <label>Tempo de residÃªncia no Brasil</label>
              <select id="calc-tempo" onchange="calcUpdate()">
                <option value="">â€” selecione â€”</option>
                <option value="menos1">Menos de 1 ano</option>
                <option value="1a4">1 a 4 anos</option>
                <option value="4a15">4 a 15 anos</option>
                <option value="mais15">Mais de 15 anos</option>
                <option value="na">NÃ£o resido no Brasil</option>
              </select>
            </div>
            <div class="form-field">
              <label>VÃ­nculo com Brasil</label>
              <select id="calc-vinculo" onchange="calcUpdate()">
                <option value="">â€” selecione â€”</option>
                <option value="conjugeBR">CÃ´njuge/companheiro(a) brasileiro(a)</option>
                <option value="filhoBR">Filho(a) brasileiro(a)</option>
                <option value="trabalho">Contrato de trabalho no Brasil</option>
                <option value="estudo">Estudante / pesquisador</option>
                <option value="nenhum">Nenhum vÃ­nculo</option>
              </select>
            </div>
            <div class="form-field">
              <label>Possui passaporte vÃ¡lido?</label>
              <select id="calc-pass" onchange="calcUpdate()">
                <option value="">â€” selecione â€”</option>
                <option value="sim">Sim, com â‰¥ 6 meses de validade</option>
                <option value="vencendo">Sim, mas vencendo em breve</option>
                <option value="nao">NÃ£o</option>
              </select>
            </div>
            <div class="form-field">
              <label>Antecedentes criminais?</label>
              <select id="calc-criminal" onchange="calcUpdate()">
                <option value="">â€” selecione â€”</option>
                <option value="nao">NÃ£o</option>
                <option value="sim">Sim</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <div id="calc-resultado" style="display:none"></div>
    </div>
  `;
}

function calcUpdate() {
  const nac = document.getElementById('calc-nac')?.value;
  const obj = document.getElementById('calc-obj')?.value;
  const tempo = document.getElementById('calc-tempo')?.value;
  const vinculo = document.getElementById('calc-vinculo')?.value;
  const pass = document.getElementById('calc-pass')?.value;
  const criminal = document.getElementById('calc-criminal')?.value;
  const res = document.getElementById('calc-resultado');
  if (!res) return;
  if (!nac || !obj || !tempo || !vinculo || !pass || !criminal) { res.style.display='none'; return; }
  res.style.display='block';

  let recomendacoes = [];
  let alertas = [];

  if (obj === 'nat') {
    if (criminal === 'sim') { alertas.push('âš ï¸ Antecedentes criminais podem inviabilizar a naturalizaÃ§Ã£o (Art. 65, Â§1Âº, Lei nÂº 13.445/2017). Consulte um advogado.'); }
    if (tempo === 'mais15' && criminal === 'nao') {
      recomendacoes.push({ tipo:'âœ… ALTAMENTE RECOMENDADO', serv:'NaturalizaÃ§Ã£o ExtraordinÃ¡ria', desc:'VocÃª preenche o requisito de +15 anos de residÃªncia ininterrupta sem condenaÃ§Ã£o penal.', base:'Art. 67, Lei nÂº 13.445/2017', cor:'var(--green)' });
    } else if ((tempo === '4a15' || tempo === 'mais15') && (vinculo === 'conjugeBR' || vinculo === 'filhoBR')) {
      recomendacoes.push({ tipo:'âœ… ELEGÃVEL', serv:'NaturalizaÃ§Ã£o OrdinÃ¡ria (prazo reduzido â€“ 1 ano)', desc:'Por ter cÃ´njuge ou filho brasileiro, o prazo de residÃªncia cai para 1 ano.', base:'Art. 65, Â§1Âº, I, Lei nÂº 13.445/2017', cor:'var(--gold)' });
    } else if (tempo === '4a15' || tempo === 'mais15') {
      recomendacoes.push({ tipo:'âœ… ELEGÃVEL', serv:'NaturalizaÃ§Ã£o OrdinÃ¡ria', desc:'ResidÃªncia por prazo indeterminado hÃ¡ â‰¥ 4 anos. Verifique ausÃªncias do Brasil.', base:'Art. 65, Lei nÂº 13.445/2017', cor:'var(--gold)' });
    } else if (tempo === '1a4' && (nac === 'pt' || nac === 'cplp')) {
      recomendacoes.push({ tipo:'âœ… ELEGÃVEL', serv:'NaturalizaÃ§Ã£o OrdinÃ¡ria (prazo reduzido â€“ 1 ano)', desc:'PaÃ­ses da CPLP tÃªm prazo reduzido para 1 ano de residÃªncia.', base:'Art. 65, Â§1Âº, III, Lei nÂº 13.445/2017', cor:'var(--gold)' });
    } else {
      recomendacoes.push({ tipo:'âš ï¸ AINDA NÃƒO', serv:'NaturalizaÃ§Ã£o â€“ prazo insuficiente', desc:'VocÃª ainda nÃ£o atinge o prazo mÃ­nimo de residÃªncia exigido. Continue acumulando tempo.', base:'Art. 65, Lei nÂº 13.445/2017', cor:'var(--orange)' });
    }
  }
  if (obj === 'residir' || obj === 'trabalho') {
    if (vinculo === 'trabalho') {
      recomendacoes.push({ tipo:'âœ… RECOMENDADO', serv:'AutorizaÃ§Ã£o de ResidÃªncia Laboral (RNM)', desc:'Contrato de trabalho com empresa brasileira habilita a residÃªncia por prazo determinado.', base:'Art. 30, I, "e", Lei nÂº 13.445/2017', cor:'var(--gold)' });
    }
    if (vinculo === 'conjugeBR' || vinculo === 'filhoBR') {
      recomendacoes.push({ tipo:'âœ… RECOMENDADO', serv:'AutorizaÃ§Ã£o de ResidÃªncia por ReuniÃ£o Familiar (RNM)', desc:'CÃ´njuge ou filho brasileiro garante direito a residÃªncia familiar.', base:'Art. 30, II, Lei nÂº 13.445/2017', cor:'var(--gold)' });
    }
    if (vinculo === 'estudo') {
      recomendacoes.push({ tipo:'âœ… ELEGÃVEL', serv:'AutorizaÃ§Ã£o de ResidÃªncia para Pesquisa/Ensino (RNM)', desc:'VÃ­nculo com instituiÃ§Ã£o de ensino superior credenciada pelo MEC.', base:'Art. 30, I, "d", Lei nÂº 13.445/2017', cor:'var(--accent)' });
    }
    if (vinculo === 'nenhum' && nac === 'mercosul') {
      recomendacoes.push({ tipo:'âœ… ELEGÃVEL', serv:'AutorizaÃ§Ã£o de ResidÃªncia Mercosul (RNM)', desc:'Nacionais do Mercosul podem residir com base em acordo bilateral simplificado.', base:'Acordo de ResidÃªncia do Mercosul, Dec. nÂº 6.975/2009', cor:'var(--accent)' });
    }
  }
  if (obj === 'visto') {
    if (pass === 'nao') { alertas.push('âš ï¸ VocÃª precisa de passaporte vÃ¡lido com â‰¥ 6 meses alÃ©m da data de retorno para solicitar o visto americano (INA Â§ 212(a)(7)(B)(i)).'); }
    else if (criminal === 'sim') { alertas.push('âš ï¸ Antecedentes criminais podem gerar inadmissibilidade nos EUA (INA Â§ 212(a)(2)). AvaliaÃ§Ã£o jurÃ­dica necessÃ¡ria antes de solicitar.'); }
    else {
      recomendacoes.push({ tipo:'âœ… PODE SOLICITAR', serv:'Visto de Turismo EUA B-1/B-2', desc:'Com passaporte vÃ¡lido e sem antecedentes, vocÃª pode solicitar o visto. O principal desafio Ã© provar vÃ­nculos no Brasil (INA Â§ 214(b)).', base:'INA Â§ 101(a)(15)(B) | 9 FAM 402.2', cor:'var(--gold)' });
      if (vinculo === 'nenhum') alertas.push('âš ï¸ Sem vÃ­nculos sÃ³lidos (emprego, imÃ³vel, famÃ­lia) no Brasil, o risco de negativa Ã© alto. O oficial consular deve ser convencido do seu retorno (INA Â§ 214(b)).');
    }
  }

  res.innerHTML = `
    ${alertas.map(a=>`<div style="background:rgba(245,158,11,0.1);border:1px solid rgba(245,158,11,0.3);border-radius:12px;padding:14px 18px;margin-bottom:14px;font-size:0.84rem;color:var(--orange)">${a}</div>`).join('')}
    ${recomendacoes.map(r=>`
      <div style="background:var(--navy3);border:1px solid var(--border2);border-left:4px solid ${r.cor};border-radius:12px;padding:20px;margin-bottom:14px">
        <div style="font-size:0.72rem;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:${r.cor};margin-bottom:8px">${r.tipo}</div>
        <div style="font-size:1rem;font-weight:700;color:var(--text);margin-bottom:6px">${r.serv}</div>
        <div style="font-size:0.83rem;color:var(--text2);margin-bottom:10px">${r.desc}</div>
        <div style="font-size:0.7rem;font-family:'DM Mono',monospace;color:var(--gold);background:rgba(201,168,76,0.07);display:inline-block;padding:4px 10px;border-radius:6px">ğŸ“œ ${r.base}</div>
      </div>`).join('')}
    <div style="text-align:center;margin-top:8px">
      <button class="btn btn-gold" onclick="navigateTo('clientes');setTimeout(openNovoCliente,100)">Cadastrar Cliente para este ServiÃ§o</button>
    </div>
  `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â° PRAZOS & ALERTAS DE VENCIMENTO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderPrazos() {
  const hoje = new Date('2025-02-26');
  const alertas = [
    { cliente:'Ana Cristina Souza', tipo:'Documento Pendente', item:'Comprovante de ResidÃªncia (5 anos)', prazo:'10/03/2025', dias:12, nivel:'alto' },
    { cliente:'JoÃ£o Pedro Ferreira', tipo:'InÃ­cio de Processo', item:'DocumentaÃ§Ã£o Inicial ainda nÃ£o entregue', prazo:'05/03/2025', dias:7, nivel:'alto' },
    { cliente:'Maria Fernanda Oliveira', tipo:'Agendamento Consular', item:'DS-160 aguardando confirmaÃ§Ã£o para entrevista EUA', prazo:'15/03/2025', dias:17, nivel:'medio' },
    { cliente:'Roberto Silva Santos', tipo:'Coleta de Docs', item:'Comprovante de EndereÃ§o BR + Reg. Policial pendente', prazo:'20/03/2025', dias:22, nivel:'medio' },
    { cliente:'Carlos Eduardo Lima', tipo:'CRNM Vencimento', item:'AutorizaÃ§Ã£o de ResidÃªncia vence em 90 dias', prazo:'28/05/2025', dias:91, nivel:'baixo' },
    { cliente:'Lucia Aparecida Mendes', tipo:'Visto EUA', item:'Visto B-2 vence em 180 dias â€” planejar nova solicitaÃ§Ã£o?', prazo:'25/08/2025', dias:180, nivel:'baixo' },
  ];
  const corNivel = { alto:'var(--red)', medio:'var(--orange)', baixo:'var(--gold)' };
  const bgNivel = { alto:'rgba(239,68,68,0.08)', medio:'rgba(245,158,11,0.08)', baixo:'rgba(201,168,76,0.06)' };
  const labelNivel = { alto:'ğŸ”´ URGENTE', medio:'ğŸŸ¡ ATENÃ‡ÃƒO', baixo:'ğŸŸ¢ MONITORAR' };

  return `
    <div class="stat-grid" style="margin-bottom:28px">
      <div class="stat-card red"><div class="stat-icon">ğŸš¨</div><div class="stat-label">Urgentes (â‰¤7 dias)</div><div class="stat-value">${alertas.filter(a=>a.dias<=7).length}</div></div>
      <div class="stat-card gold"><div class="stat-icon">âš ï¸</div><div class="stat-label">AtenÃ§Ã£o (8â€“30 dias)</div><div class="stat-value">${alertas.filter(a=>a.dias>7&&a.dias<=30).length}</div></div>
      <div class="stat-card green"><div class="stat-icon">ğŸ“…</div><div class="stat-label">Monitorar (+30 dias)</div><div class="stat-value">${alertas.filter(a=>a.dias>30).length}</div></div>
      <div class="stat-card blue"><div class="stat-icon">ğŸ“‹</div><div class="stat-label">Total de Alertas</div><div class="stat-value">${alertas.length}</div></div>
    </div>

    <div class="panel">
      <div class="panel-header">
        <span class="panel-title">Todos os Prazos & Alertas</span>
        <button class="btn btn-outline btn-sm" onclick="alert('Exportando relatÃ³rio de prazos...')">ğŸ“„ Exportar</button>
      </div>
      <div class="panel-body" style="display:flex;flex-direction:column;gap:10px">
        ${alertas.sort((a,b)=>a.dias-b.dias).map(a=>`
          <div style="background:${bgNivel[a.nivel]};border:1px solid ${corNivel[a.nivel]}33;border-left:4px solid ${corNivel[a.nivel]};border-radius:12px;padding:16px 18px;display:flex;align-items:center;gap:16px;flex-wrap:wrap">
            <div style="flex-shrink:0;min-width:100px">
              <div style="font-size:0.65rem;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:${corNivel[a.nivel]}">${labelNivel[a.nivel]}</div>
              <div style="font-family:'DM Mono',monospace;font-size:1.1rem;font-weight:700;color:${corNivel[a.nivel]};margin-top:2px">${a.dias}d</div>
            </div>
            <div style="flex:1">
              <div style="font-weight:600;color:var(--text);font-size:0.88rem">${a.cliente}</div>
              <div style="font-size:0.78rem;color:var(--text3);margin-top:2px"><span class="badge badge-gray">${a.tipo}</span></div>
              <div style="font-size:0.8rem;color:var(--text2);margin-top:6px">${a.item}</div>
            </div>
            <div style="text-align:right;flex-shrink:0">
              <div style="font-size:0.68rem;color:var(--text3);text-transform:uppercase;letter-spacing:1px">Prazo</div>
              <div style="font-family:'DM Mono',monospace;font-size:0.85rem;color:var(--text);margin-top:2px">${a.prazo}</div>
              <button class="btn btn-outline btn-sm" style="margin-top:8px" onclick="alert('Notificar ${a.cliente}')">ğŸ“§ Notificar</button>
            </div>
          </div>`).join('')}
      </div>
    </div>
  `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“„ MODELOS DE DOCUMENTOS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderModelos() {
  const modelos = [
    { cat:'NaturalizaÃ§Ã£o', nome:'Carta de ApresentaÃ§Ã£o ao MJ', desc:'Modelo padrÃ£o de carta de apresentaÃ§Ã£o para protocolo de naturalizaÃ§Ã£o ordinÃ¡ria', tags:['MJ','NaturalizaÃ§Ã£o','Portaria 623/2020'] },
    { cat:'NaturalizaÃ§Ã£o', nome:'DeclaraÃ§Ã£o de ResidÃªncia Ininterrupta', desc:'DeclaraÃ§Ã£o pessoal do requerente atestando residÃªncia contÃ­nua no Brasil pelo prazo legal exigido', tags:['Art. 65','Lei 13.445/2017'] },
    { cat:'NaturalizaÃ§Ã£o', nome:'Requerimento de NaturalizaÃ§Ã£o (Modelo)', desc:'FormulÃ¡rio de requerimento formatado conforme o Anexo I da Portaria MJ nÂº 623/2020', tags:['Portaria 623/2020','Anexo I'] },
    { cat:'NaturalizaÃ§Ã£o', nome:'ProcuraÃ§Ã£o para Ato MigratÃ³rio', desc:'Outorga de poderes especÃ­ficos Ã  WB Assessoria para representar o cliente perante o MJSP/PF', tags:['ProcuraÃ§Ã£o','MJSP'] },
    { cat:'RNM / ResidÃªncia', nome:'Carta de VÃ­nculo Familiar', desc:'DeclaraÃ§Ã£o de cÃ´njuge/filho(a) brasileiro(a) para fins de reuniÃ£o familiar (RNM)', tags:['Art. 30, II','Lei 13.445/2017'] },
    { cat:'RNM / ResidÃªncia', nome:'Requerimento de AutorizaÃ§Ã£o de ResidÃªncia', desc:'Modelo padrÃ£o para protocolo no MigranteWeb, conforme RN CNIg nÂº 1/2017', tags:['RN CNIg 1/2017','MigranteWeb'] },
    { cat:'Visto EUA', nome:'Carta de ApresentaÃ§Ã£o para Entrevista Consular', desc:'Carta explicando o propÃ³sito da viagem, vÃ­nculos no Brasil e dados financeiros ao Consulado EUA', tags:['9 FAM 402.2','DS-160'] },
    { cat:'Visto EUA', nome:'DeclaraÃ§Ã£o de PatrocÃ­nio Financeiro', desc:'Carta de terceiro que custeia a viagem aos EUA, com comprovaÃ§Ã£o de renda', tags:['9 FAM 402.2-5(B)'] },
    { cat:'Interno WB', nome:'Contrato de PrestaÃ§Ã£o de ServiÃ§os â€“ NaturalizaÃ§Ã£o', desc:'Contrato padrÃ£o WB para serviÃ§os de assessoria em naturalizaÃ§Ã£o brasileira', tags:['Interno','CC/2002 Art. 421'] },
    { cat:'Interno WB', nome:'Contrato de PrestaÃ§Ã£o de ServiÃ§os â€“ RNM', desc:'Contrato padrÃ£o WB para serviÃ§os de assessoria em AutorizaÃ§Ã£o de ResidÃªncia', tags:['Interno'] },
    { cat:'Interno WB', nome:'Termo de CiÃªncia de DocumentaÃ§Ã£o', desc:'Termo onde o cliente declara ter entregado os documentos listados no checklist', tags:['Interno','Checklist'] },
  ];
  const cats = [...new Set(modelos.map(m=>m.cat))];
  const catColors = { 'NaturalizaÃ§Ã£o':'var(--gold)', 'RNM / ResidÃªncia':'var(--accent)', 'Visto EUA':'var(--green)', 'Interno WB':'var(--text3)' };

  return `
    ${cats.map(cat=>`
      <div class="panel" style="margin-bottom:20px">
        <div class="panel-header" style="border-bottom:1px solid var(--border2)">
          <span class="panel-title" style="color:${catColors[cat]}">ğŸ“ ${cat}</span>
          <span style="font-size:0.75rem;color:var(--text3)">${modelos.filter(m=>m.cat===cat).length} modelos</span>
        </div>
        <div class="panel-body" style="display:grid;grid-template-columns:1fr 1fr;gap:14px">
          ${modelos.filter(m=>m.cat===cat).map(m=>`
            <div style="background:var(--navy4);border-radius:12px;padding:16px;border:1px solid var(--border2);display:flex;flex-direction:column;gap:10px">
              <div>
                <div style="font-size:0.85rem;font-weight:600;color:var(--text)">${m.nome}</div>
                <div style="font-size:0.77rem;color:var(--text3);margin-top:4px;line-height:1.4">${m.desc}</div>
              </div>
              <div style="display:flex;flex-wrap:wrap;gap:5px">
                ${m.tags.map(t=>`<span style="font-size:0.65rem;padding:2px 7px;background:rgba(255,255,255,0.05);border:1px solid var(--border2);border-radius:4px;color:var(--text3)">${t}</span>`).join('')}
              </div>
              <div style="display:flex;gap:8px;margin-top:auto">
                <button class="btn btn-gold btn-sm" style="flex:1" onclick="alert('Abrindo modelo: ${m.nome}')">âœï¸ Usar</button>
                <button class="btn btn-outline btn-sm" onclick="alert('Baixando: ${m.nome}.docx')">â¬‡ï¸</button>
              </div>
            </div>`).join('')}
        </div>
      </div>`).join('')}
  `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“‘ CONTRATOS & PROPOSTAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderContratos() {
  const propostas = [
    { cliente:'Ana Cristina Souza', servico:'NaturalizaÃ§Ã£o Brasileira', valor:4500, emissao:'10/01/2025', status:'Assinado', venc:'â€”' },
    { cliente:'JoÃ£o Pedro Ferreira', servico:'NaturalizaÃ§Ã£o Brasileira', valor:4500, emissao:'20/01/2025', status:'Aguardando Assinatura', venc:'05/03/2025' },
    { cliente:'Maria Fernanda Oliveira', servico:'Visto de Turismo (EUA)', valor:2800, emissao:'15/01/2025', status:'Assinado', venc:'â€”' },
    { cliente:'Roberto Silva Santos', servico:'AutorizaÃ§Ã£o de ResidÃªncia (RNM)', valor:3800, emissao:'08/02/2025', status:'Em elaboraÃ§Ã£o', venc:'â€”' },
  ];
  const stColor = { 'Assinado':'badge-green', 'Aguardando Assinatura':'badge-orange', 'Em elaboraÃ§Ã£o':'badge-blue' };

  return `
    <div style="display:flex;gap:12px;margin-bottom:24px">
      <button class="btn btn-gold" onclick="openNovaPropostaModal()">+ Nova Proposta</button>
      <button class="btn btn-outline" onclick="alert('Abrindo gerador de contrato...')">ğŸ“„ Gerar Contrato</button>
    </div>

    <div class="stat-grid" style="margin-bottom:24px">
      <div class="stat-card green"><div class="stat-label">Assinados</div><div class="stat-value">${propostas.filter(p=>p.status==='Assinado').length}</div></div>
      <div class="stat-card gold"><div class="stat-label">Aguardando</div><div class="stat-value">${propostas.filter(p=>p.status==='Aguardando Assinatura').length}</div></div>
      <div class="stat-card blue"><div class="stat-label">Em elaboraÃ§Ã£o</div><div class="stat-value">${propostas.filter(p=>p.status==='Em elaboraÃ§Ã£o').length}</div></div>
      <div class="stat-card gold"><div class="stat-label">Volume contratado</div><div class="stat-value">R$${(propostas.reduce((a,b)=>a+b.valor,0)/1000).toFixed(1)}k</div></div>
    </div>

    <div class="panel">
      <div class="panel-header"><span class="panel-title">Contratos & Propostas</span></div>
      <div class="panel-body" style="padding:0">
        <table class="tbl">
          <thead><tr><th>Cliente</th><th>ServiÃ§o</th><th>Valor</th><th>EmissÃ£o</th><th>Status</th><th>Vencimento</th><th>AÃ§Ãµes</th></tr></thead>
          <tbody>
            ${propostas.map(p=>`
              <tr>
                <td style="font-weight:500;color:var(--text)">${p.cliente.split(' ').slice(0,2).join(' ')}</td>
                <td style="font-size:0.78rem">${servicoBadge(p.servico)}</td>
                <td style="font-family:'DM Mono',monospace;color:var(--gold);font-size:0.8rem">R$ ${p.valor.toLocaleString('pt-BR')}</td>
                <td style="font-family:'DM Mono',monospace;font-size:0.78rem">${p.emissao}</td>
                <td><span class="badge ${stColor[p.status]}">${p.status}</span></td>
                <td style="font-size:0.78rem;color:${p.venc!=='â€”'?'var(--orange)':'var(--text3)'}">${p.venc}</td>
                <td style="display:flex;gap:6px">
                  <button class="btn btn-sm btn-outline" onclick="alert('Abrindo contrato de ${p.cliente}')">ğŸ‘</button>
                  <button class="btn btn-sm btn-outline" onclick="alert('Enviando por e-mail...')">ğŸ“§</button>
                </td>
              </tr>`).join('')}
          </tbody>
        </table>
      </div>
    </div>
  `;
}

function openNovaPropostaModal() {
  openModal(`
    <div class="modal-title">Nova Proposta de ServiÃ§o</div>
    <div class="form-grid">
      <div class="form-field"><label>Cliente</label><select>${clientes.map(c=>`<option>${c.nome}</option>`).join('')}</select></div>
      <div class="form-field"><label>ServiÃ§o</label><select><option>NaturalizaÃ§Ã£o Brasileira</option><option>AutorizaÃ§Ã£o de ResidÃªncia (RNM)</option><option>Visto de Turismo (EUA)</option></select></div>
      <div class="form-field"><label>Valor (R$)</label><input type="number" placeholder="0,00"></div>
      <div class="form-field"><label>Forma de Pagamento</label><select><option>Ã€ vista</option><option>2x sem juros</option><option>3x sem juros</option><option>Entrada + restante</option></select></div>
      <div class="form-field"><label>Validade da Proposta</label><input type="date"></div>
      <div class="form-field"><label>ResponsÃ¡vel WB</label><select><option>Fernanda Costa</option><option>William Borges</option></select></div>
      <div class="form-field form-full"><label>ObservaÃ§Ãµes / Escopo detalhado</label><textarea placeholder="Descreva os serviÃ§os incluÃ­dos..."></textarea></div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-gold" onclick="alert('Proposta gerada e enviada por e-mail!');closeModal()">ğŸ“§ Gerar & Enviar</button>
      <button class="btn btn-outline" onclick="closeModal()">Cancelar</button>
    </div>
  `);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âŒ INDEFERIMENTOS & RECURSOS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderIndeferimentos() {
  const casos = [
    { cliente:'Pedro Alvares Costa', servico:'Visto de Turismo EUA', motivo:'INA Â§ 214(b) â€“ vÃ­nculos insuficientes com Brasil', data:'15/01/2025', status:'Recurso em prep.', estrategia:'Fortalecer documentaÃ§Ã£o de vÃ­nculos: emprego, imÃ³vel, extrato bancÃ¡rio robusto. Solicitar nova entrevista com carta de apresentaÃ§Ã£o melhorada.' },
    { cliente:'Fatima Zahra Benali', servico:'NaturalizaÃ§Ã£o OrdinÃ¡ria', motivo:'Portaria 623/2020 â€“ comprovante de residÃªncia insuficiente (lacunas)', data:'10/02/2025', status:'Recurso protocolado', estrategia:'Recurso administrativo ao MJSP com DeclaraÃ§Ã£o Complementar de ResidÃªncia e testemunhas. Base: Art. 56 da Lei nÂº 9.784/1999.' },
  ];
  return `
    <div style="display:flex;gap:12px;margin-bottom:24px">
      <button class="btn btn-gold" onclick="openNovoIndeferimento()">+ Registrar Indeferimento</button>
    </div>

    <div class="panel" style="margin-bottom:24px;border-color:rgba(239,68,68,0.25)">
      <div class="panel-header" style="background:rgba(239,68,68,0.04)">
        <span class="panel-title" style="color:#f87171">âš–ï¸ Principais Motivos de Indeferimento por ServiÃ§o</span>
      </div>
      <div class="panel-body" style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px">
        <div style="background:var(--navy4);border-radius:10px;padding:14px">
          <div style="font-size:0.75rem;font-weight:700;color:var(--gold);margin-bottom:10px">ğŸ‡§ğŸ‡· NaturalizaÃ§Ã£o</div>
          ${['Prazo de residÃªncia insuficiente (Art. 65)','AusÃªncias prolongadas do Brasil','CertidÃ£o de antecedentes com registro','Comprovante de renda insuficiente','Documentos sem apostila ou traduÃ§Ã£o (Dec. 8.660/2016)'].map(m=>`<div style="font-size:0.75rem;color:var(--text3);padding:5px 0;border-bottom:1px solid var(--border2)">â€¢ ${m}</div>`).join('')}
        </div>
        <div style="background:var(--navy4);border-radius:10px;padding:14px">
          <div style="font-size:0.75rem;font-weight:700;color:var(--accent);margin-bottom:10px">ğŸªª RNM / ResidÃªncia</div>
          ${['Passaporte vencido ou invÃ¡lido','Visto sem cobertura para residÃªncia','AusÃªncia de vÃ­nculo laboral/familiar','Antecedentes criminais no Brasil','GRU nÃ£o paga ou vencida'].map(m=>`<div style="font-size:0.75rem;color:var(--text3);padding:5px 0;border-bottom:1px solid var(--border2)">â€¢ ${m}</div>`).join('')}
        </div>
        <div style="background:var(--navy4);border-radius:10px;padding:14px">
          <div style="font-size:0.75rem;font-weight:700;color:var(--green);margin-bottom:10px">âœˆï¸ Visto EUA</div>
          ${['INA Â§ 214(b) â€“ intenÃ§Ã£o de imigrar','VÃ­nculos insuficientes com Brasil','HistÃ³rico de overstay anterior','Capacidade financeira questionÃ¡vel','Viagens anteriores negadas (recorrÃªncia)'].map(m=>`<div style="font-size:0.75rem;color:var(--text3);padding:5px 0;border-bottom:1px solid var(--border2)">â€¢ ${m}</div>`).join('')}
        </div>
      </div>
    </div>

    <div class="panel">
      <div class="panel-header"><span class="panel-title">Casos de Indeferimento Ativos</span></div>
      <div class="panel-body" style="display:flex;flex-direction:column;gap:16px">
        ${casos.map(c=>`
          <div style="background:var(--navy4);border-radius:12px;padding:18px;border-left:4px solid var(--red)">
            <div style="display:flex;justify-content:space-between;flex-wrap:wrap;gap:8px;margin-bottom:10px">
              <div>
                <div style="font-size:0.9rem;font-weight:700;color:var(--text)">${c.cliente}</div>
                <div style="font-size:0.78rem;color:var(--text3);margin-top:3px">${c.servico} â€” Indeferido em ${c.data}</div>
              </div>
              <span class="badge badge-orange">${c.status}</span>
            </div>
            <div style="background:rgba(239,68,68,0.07);border-radius:8px;padding:10px 12px;margin-bottom:10px">
              <div style="font-size:0.68rem;text-transform:uppercase;letter-spacing:1px;color:var(--red);margin-bottom:4px">Motivo do Indeferimento</div>
              <div style="font-size:0.8rem;color:var(--text2)">${c.motivo}</div>
            </div>
            <div style="background:rgba(16,185,129,0.06);border-radius:8px;padding:10px 12px">
              <div style="font-size:0.68rem;text-transform:uppercase;letter-spacing:1px;color:var(--green);margin-bottom:4px">EstratÃ©gia de Recurso</div>
              <div style="font-size:0.8rem;color:var(--text2)">${c.estrategia}</div>
            </div>
            <div style="display:flex;gap:8px;margin-top:12px">
              <button class="btn btn-outline btn-sm">ğŸ“„ Ver Processo Completo</button>
              <button class="btn btn-gold btn-sm" onclick="alert('Preparando recurso...')">âš–ï¸ Iniciar Recurso</button>
            </div>
          </div>`).join('')}
        ${casos.length===0?'<div style="text-align:center;color:var(--text3);padding:30px">Nenhum indeferimento registrado.</div>':''}
      </div>
    </div>
  `;
}

function openNovoIndeferimento() {
  openModal(`
    <div class="modal-title">Registrar Indeferimento</div>
    <div class="form-grid">
      <div class="form-field"><label>Cliente</label><select>${clientes.map(c=>`<option>${c.nome}</option>`).join('')}</select></div>
      <div class="form-field"><label>ServiÃ§o Indeferido</label><select><option>NaturalizaÃ§Ã£o Brasileira</option><option>AutorizaÃ§Ã£o de ResidÃªncia (RNM)</option><option>Visto de Turismo (EUA)</option></select></div>
      <div class="form-field"><label>Data do Indeferimento</label><input type="date"></div>
      <div class="form-field"><label>Ã“rgÃ£o</label><select><option>MJSP / SENAJUS</option><option>PolÃ­cia Federal</option><option>Consulado EUA</option></select></div>
      <div class="form-field form-full"><label>Motivo (fundamento legal citado)</label><textarea placeholder="Ex: INA Â§ 214(b) â€“ vÃ­nculos insuficientes..."></textarea></div>
      <div class="form-field form-full"><label>EstratÃ©gia de Recurso</label><textarea placeholder="Descreva a estratÃ©gia para reverter o indeferimento..."></textarea></div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-gold" onclick="alert('Caso registrado!');closeModal()">Registrar</button>
      <button class="btn btn-outline" onclick="closeModal()">Cancelar</button>
    </div>
  `);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¤ REDE DE PARCEIROS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderParceiros() {
  const parceiros = [
    { nome:'Tradutora Maria JosÃ© Lemos', tipo:'TraduÃ§Ã£o Juramentada', especialidade:'PortuguÃªs, InglÃªs, Espanhol, Italiano', cidade:'SÃ£o Paulo â€“ SP', contato:'(11) 99888-7766', avaliacao:5, juccesp:'JUCESP MatrÃ­c. 1234' },
    { nome:'CartÃ³rio Notas & Registro â€“ Dr. Faria', tipo:'Tabelionato / CartÃ³rio', especialidade:'Apostila de Haia, reconhecimento de firma, autenticaÃ§Ã£o', cidade:'SÃ£o Paulo â€“ SP', contato:'(11) 3333-4444', avaliacao:5, juccesp:'â€”' },
    { nome:'Dr. Carlos Meireles (OAB/SP 45.678)', tipo:'Advogado MigratÃ³rio', especialidade:'Recursos administrativos, aÃ§Ãµes de naturalizaÃ§Ã£o judicial', cidade:'SÃ£o Paulo â€“ SP', contato:'(11) 99777-5544', avaliacao:4, juccesp:'OAB/SP 45.678' },
    { nome:'Despachante Consulado EUA â€“ Rede Vistos BR', tipo:'Agendamento Consular', especialidade:'Agendamento B1/B2, B-2 turismo, renoaÃ§Ã£o Express', cidade:'SÃ£o Paulo / Rio / Recife', contato:'contato@redesvistasbr.com.br', avaliacao:4, juccesp:'â€”' },
    { nome:'Tradutora Ana Paula Ribeiro', tipo:'TraduÃ§Ã£o Juramentada', especialidade:'AlemÃ£o, FrancÃªs, InglÃªs, PortuguÃªs', cidade:'Curitiba â€“ PR', contato:'(41) 98877-6655', avaliacao:5, juccesp:'JUCPAR MatrÃ­c. 789' },
    { nome:'Consultoria PF â€“ Agendamentos Express', tipo:'Despachante PF', especialidade:'Agendamentos PF, protocolo de documentos, CRNM', cidade:'SÃ£o Paulo â€“ SP', contato:'(11) 99666-3322', avaliacao:4, juccesp:'â€”' },
  ];
  const tipoColors = { 'TraduÃ§Ã£o Juramentada':'var(--gold)', 'Tabelionato / CartÃ³rio':'var(--accent)', 'Advogado MigratÃ³rio':'#a78bfa', 'Agendamento Consular':'var(--green)', 'Despachante PF':'var(--orange)' };

  return `
    <div style="display:flex;gap:12px;margin-bottom:24px">
      <button class="btn btn-gold" onclick="openNovoParceiro()">+ Cadastrar Parceiro</button>
    </div>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:18px">
      ${parceiros.map(p=>`
        <div style="background:var(--navy3);border:1px solid var(--border2);border-radius:16px;padding:20px;display:flex;flex-direction:column;gap:10px;transition:transform 0.2s" onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform=''">
          <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:8px">
            <div style="font-size:0.88rem;font-weight:700;color:var(--text)">${p.nome}</div>
            <div style="color:var(--gold);font-size:0.8rem;flex-shrink:0">${'â˜…'.repeat(p.avaliacao)}${'â˜†'.repeat(5-p.avaliacao)}</div>
          </div>
          <span style="font-size:0.68rem;padding:3px 9px;border-radius:20px;border:1px solid ${tipoColors[p.tipo]||'var(--border)'};color:${tipoColors[p.tipo]||'var(--text3)'};display:inline-block;width:fit-content">${p.tipo}</span>
          <div style="font-size:0.78rem;color:var(--text3)">ğŸ¯ ${p.especialidade}</div>
          <div style="font-size:0.75rem;color:var(--text3)">ğŸ“ ${p.cidade}</div>
          <div style="font-size:0.75rem;color:var(--text3)">ğŸ“ ${p.contato}</div>
          ${p.juccesp!=='â€”'?`<div style="font-size:0.68rem;color:var(--text3);font-family:'DM Mono',monospace">${p.juccesp}</div>`:''}
          <button class="btn btn-outline btn-sm" style="margin-top:auto" onclick="alert('Contato: ${p.contato}')">ğŸ“ Contatar</button>
        </div>`).join('')}
    </div>
  `;
}

function openNovoParceiro() {
  openModal(`
    <div class="modal-title">Cadastrar Parceiro</div>
    <div class="form-grid">
      <div class="form-field form-full"><label>Nome / RazÃ£o Social</label><input placeholder="Nome do parceiro ou empresa"></div>
      <div class="form-field"><label>Tipo</label><select><option>TraduÃ§Ã£o Juramentada</option><option>Tabelionato / CartÃ³rio</option><option>Advogado MigratÃ³rio</option><option>Despachante PF</option><option>Agendamento Consular</option><option>Outro</option></select></div>
      <div class="form-field"><label>Cidade / Estado</label><input placeholder="Ex: SÃ£o Paulo â€“ SP"></div>
      <div class="form-field"><label>Contato</label><input placeholder="Telefone ou e-mail"></div>
      <div class="form-field form-full"><label>Especialidade</label><input placeholder="Ex: InglÃªs, Espanhol, Apostila..."></div>
      <div class="form-field"><label>Registro Profissional</label><input placeholder="OAB, JUCESP, etc."></div>
      <div class="form-field"><label>AvaliaÃ§Ã£o</label><select><option>â­â­â­â­â­ Excelente</option><option>â­â­â­â­ Bom</option><option>â­â­â­ Regular</option></select></div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-gold" onclick="alert('Parceiro cadastrado!');closeModal()">Cadastrar</button>
      <button class="btn btn-outline" onclick="closeModal()">Cancelar</button>
    </div>
  `);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“š BASE DE CONHECIMENTO (Equipe)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderFaq() {
  const topicos = [
    {
      cat:'ğŸ‡§ğŸ‡· NaturalizaÃ§Ã£o Brasileira', items:[
        { q:'Qual a diferenÃ§a entre naturalizaÃ§Ã£o ordinÃ¡ria e extraordinÃ¡ria?', a:'A <strong>ordinÃ¡ria</strong> exige residÃªncia por prazo indeterminado por no mÃ­nimo 4 anos (reduzÃ­vel a 1 ano para cÃ´njuge/filho BR ou CPLP). A <strong>extraordinÃ¡ria</strong> exige 15 anos ininterruptos de residÃªncia e pena limpa. Base: Arts. 65 e 67, Lei nÂº 13.445/2017.' },
        { q:'Como contar as ausÃªncias do Brasil para o prazo de residÃªncia?', a:'AusÃªncias temporÃ¡rias e justificadas nÃ£o interrompem a contagem, mas devem ser declaradas e justificadas. O MJSP avalia caso a caso. Base: Art. 233, Dec. nÂº 9.199/2017.' },
        { q:'O Certificado CELPE-BRAS Ã© sempre obrigatÃ³rio?', a:'Ã‰ obrigatÃ³rio para naturalizaÃ§Ãµes ordinÃ¡rias de nÃ£o-lusÃ³fonos. Nacionais de paÃ­ses de lÃ­ngua portuguesa (Portugal, Angola, MoÃ§ambique, etc.) estÃ£o dispensados. Base: Art. 5Âº, Portaria MJ nÂº 623/2020.' },
        { q:'Qual o prazo legal para anÃ¡lise do pedido de naturalizaÃ§Ã£o?', a:'A Portaria nÂº 623/2020 e o Dec. nÂº 9.199/2017 preveem anÃ¡lise em atÃ© 180 dias corridos da data de protocolo, podendo ser prorrogado por igual perÃ­odo uma vez.' },
        { q:'O que Ã© a "Apostila de Haia" e quando Ã© necessÃ¡ria?', a:'Ã‰ o processo de autenticaÃ§Ã£o internacional de documentos pÃºblicos estrangeiros, substitui a legalizaÃ§Ã£o consular para paÃ­ses signatÃ¡rios. ObrigatÃ³ria para certidÃµes e atestados de antecedentes emitidos no exterior. Base: Dec. nÂº 8.660/2016.' },
      ]
    },
    {
      cat:'ğŸªª AutorizaÃ§Ã£o de ResidÃªncia (RNM)', items:[
        { q:'Qual a diferenÃ§a entre RNM e o antigo RNE?', a:'O RNE foi extinto pela Lei nÂº 13.445/2017 (Lei de MigraÃ§Ã£o). O RNM (Registro Nacional MigratÃ³rio) Ã© o documento atual, emitido pela PolÃ­cia Federal, com chip e biometria. Base: Arts. 30-33 e 67-69, Lei nÂº 13.445/2017.' },
        { q:'O visto de turismo pode ser convertido em autorizaÃ§Ã£o de residÃªncia?', a:'NÃ£o diretamente. O visto de turista nÃ£o gera direito Ã  residÃªncia. Ã‰ necessÃ¡rio obter um amparo legal prÃ³prio (contrato de trabalho, famÃ­lia, etc.) e protocolar o pedido antes do vencimento do visto. Base: Art. 30, Lei nÂº 13.445/2017.' },
        { q:'O que acontece se o estrangeiro ficar sem regularizaÃ§Ã£o?', a:'Sujeita-se a multa diÃ¡ria por permanÃªncia irregular e, em casos mais graves, Ã  deportaÃ§Ã£o. Base: Arts. 109-111, Lei nÂº 13.445/2017 e arts. 384-398, Dec. nÂº 9.199/2017.' },
        { q:'Nacionais do Mercosul tÃªm tratamento diferenciado?', a:'Sim. O Acordo de ResidÃªncia do Mercosul (Dec. nÂº 6.975/2009) permite residÃªncia temporÃ¡ria simplificada por 2 anos, com apenas comprovaÃ§Ã£o de nacionalidade e antecedentes criminais.' },
      ]
    },
    {
      cat:'âœˆï¸ Visto de Turismo (EUA)', items:[
        { q:'O que Ã© o INA Â§ 214(b) e como evitar negativa?', a:'Ã‰ a presunÃ§Ã£o legal de que todo solicitante pretende imigrar. Para refutar, o solicitante deve apresentar vÃ­nculos sÃ³lidos: emprego formal, imÃ³vel, famÃ­lia, renda estÃ¡vel. Quanto mais fortes os vÃ­nculos, menor o risco. Base: INA Â§ 214(b) | 9 FAM 302.1-2.' },
        { q:'O visto B-2 nega automaticamente se tive negativa anterior?', a:'NÃ£o automaticamente, mas negativas anteriores constam no sistema americano (PIMS) e sÃ£o avaliadas pelo oficial consular. Novas solicitaÃ§Ãµes devem apresentar mudanÃ§a substancial no perfil do solicitante.' },
        { q:'DS-160: posso editar apÃ³s submissÃ£o?', a:'ApÃ³s submissÃ£o definitiva, o DS-160 nÃ£o pode ser editado. Se houver erro relevante, deve-se criar um novo formulÃ¡rio. A confirmaÃ§Ã£o impressa deve ser levada Ã  entrevista. Base: State Dept â€“ CEAC.' },
        { q:'Qual o prazo de validade do visto B-1/B-2 apÃ³s emissÃ£o?', a:'Geralmente 10 anos para brasileiros (multiple entry), mas pode ser 1 ou 5 anos dependendo do perfil. A estada mÃ¡xima por visita Ã© determinada pelo agente da CBP na entrada, geralmente 6 meses. Base: 9 FAM 402.2-7.' },
      ]
    },
  ];

  return `
    <div style="max-width:800px;margin:0 auto">
      ${topicos.map(t=>`
        <div class="panel" style="margin-bottom:20px">
          <div class="panel-header"><span class="panel-title">${t.cat}</span></div>
          <div class="panel-body" style="display:flex;flex-direction:column;gap:0">
            ${t.items.map((item,i)=>`
              <div style="border-bottom:${i<t.items.length-1?'1px solid var(--border2)':'none'};padding:14px 0">
                <div style="font-size:0.85rem;font-weight:600;color:var(--gold);cursor:pointer;display:flex;justify-content:space-between;align-items:flex-start;gap:10px" onclick="var ans=this.nextElementSibling;ans.style.display=ans.style.display==='block'?'none':'block'">
                  <span>${item.q}</span><span style="flex-shrink:0;font-size:0.8rem">â–¼</span>
                </div>
                <div style="display:none;font-size:0.82rem;color:var(--text2);margin-top:10px;line-height:1.6;padding:12px;background:var(--navy4);border-radius:8px">${item.a}</div>
              </div>`).join('')}
          </div>
        </div>`).join('')}
    </div>
  `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ’³ FINANCEIRO AVANÃ‡ADO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PARCELAS_DATA = [
  { id:1, cliente:'Ana Cristina Souza', servico:'NaturalizaÃ§Ã£o Brasileira', valorTotal:4500, parcelas:[
    { num:1, valor:1500, venc:'10/01/2025', status:'pago', dtPgto:'10/01/2025' },
    { num:2, valor:1500, venc:'10/02/2025', status:'pago', dtPgto:'09/02/2025' },
    { num:3, valor:1500, venc:'10/03/2025', status:'pendente', dtPgto:null },
  ]},
  { id:2, cliente:'JoÃ£o Pedro Ferreira', servico:'NaturalizaÃ§Ã£o Brasileira', valorTotal:4500, parcelas:[
    { num:1, valor:2250, venc:'20/01/2025', status:'atrasado', dtPgto:null },
    { num:2, valor:2250, venc:'20/02/2025', status:'atrasado', dtPgto:null },
  ]},
  { id:3, cliente:'Maria Fernanda Oliveira', servico:'Visto de Turismo (EUA)', valorTotal:2800, parcelas:[
    { num:1, valor:2800, venc:'15/01/2025', status:'pago', dtPgto:'15/01/2025' },
  ]},
  { id:4, cliente:'Roberto Silva Santos', servico:'AutorizaÃ§Ã£o de ResidÃªncia (RNM)', valorTotal:3800, parcelas:[
    { num:1, valor:1900, venc:'08/02/2025', status:'atrasado', dtPgto:null },
    { num:2, valor:1900, venc:'08/03/2025', status:'pendente', dtPgto:null },
  ]},
  { id:5, cliente:'Carlos Eduardo Lima', servico:'AutorizaÃ§Ã£o de ResidÃªncia (RNM)', valorTotal:3800, parcelas:[
    { num:1, valor:1900, venc:'05/12/2024', status:'pago', dtPgto:'05/12/2024' },
    { num:2, valor:1900, venc:'05/01/2025', status:'pago', dtPgto:'04/01/2025' },
  ]},
  { id:6, cliente:'Lucia Aparecida Mendes', servico:'Visto de Turismo (EUA)', valorTotal:2800, parcelas:[
    { num:1, valor:2800, venc:'02/11/2024', status:'pago', dtPgto:'02/11/2024' },
  ]},
];

function renderFinanceiroAvancado() {
  const todasParcelas = PARCELAS_DATA.flatMap(c => c.parcelas.map(p => ({...p, cliente: c.cliente, servico: c.servico, totalContrato: c.valorTotal})));
  const totalRecebido  = todasParcelas.filter(p=>p.status==='pago').reduce((a,p)=>a+p.valor,0);
  const totalPendente  = todasParcelas.filter(p=>p.status==='pendente').reduce((a,p)=>a+p.valor,0);
  const totalAtrasado  = todasParcelas.filter(p=>p.status==='atrasado').reduce((a,p)=>a+p.valor,0);
  const totalGeral     = todasParcelas.reduce((a,p)=>a+p.valor,0);
  const inadimplentes  = [...new Set(todasParcelas.filter(p=>p.status==='atrasado').map(p=>p.cliente))];

  const stColor = { pago:'badge-green', pendente:'badge-gold', atrasado:'badge-red' };
  const stLabel = { pago:'âœ“ Pago', pendente:'â³ Pendente', atrasado:'ğŸš¨ Atrasado' };

  return `
    <!-- KPIs -->
    <div class="stat-grid" style="margin-bottom:28px">
      <div class="stat-card green">
        <div class="stat-icon">ğŸ’š</div>
        <div class="stat-label">Total Recebido</div>
        <div class="stat-value">R$${(totalRecebido/1000).toFixed(1)}k</div>
        <div class="stat-sub">${todasParcelas.filter(p=>p.status==='pago').length} parcela(s) quitada(s)</div>
      </div>
      <div class="stat-card gold">
        <div class="stat-icon">â³</div>
        <div class="stat-label">A Receber</div>
        <div class="stat-value">R$${(totalPendente/1000).toFixed(1)}k</div>
        <div class="stat-sub">${todasParcelas.filter(p=>p.status==='pendente').length} parcela(s) a vencer</div>
      </div>
      <div class="stat-card red">
        <div class="stat-icon">ğŸš¨</div>
        <div class="stat-label">Em Atraso</div>
        <div class="stat-value">R$${(totalAtrasado/1000).toFixed(1)}k</div>
        <div class="stat-sub">${inadimplentes.length} cliente(s) inadimplente(s)</div>
      </div>
      <div class="stat-card blue">
        <div class="stat-icon">ğŸ“Š</div>
        <div class="stat-label">Volume Contratado</div>
        <div class="stat-value">R$${(totalGeral/1000).toFixed(1)}k</div>
        <div class="stat-sub">${PARCELAS_DATA.length} contratos ativos</div>
      </div>
    </div>

    <!-- INADIMPLÃŠNCIA DESTAQUE -->
    ${inadimplentes.length > 0 ? `
    <div style="background:rgba(239,68,68,0.07);border:1px solid rgba(239,68,68,0.25);border-radius:16px;padding:20px 24px;margin-bottom:24px">
      <div style="font-size:0.75rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:#f87171;margin-bottom:12px">ğŸš¨ Clientes Inadimplentes</div>
      <div style="display:flex;flex-wrap:wrap;gap:10px">
        ${inadimplentes.map(nome => {
          const valor = todasParcelas.filter(p=>p.status==='atrasado'&&p.cliente===nome).reduce((a,p)=>a+p.valor,0);
          return `<div style="background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);border-radius:10px;padding:10px 16px;display:flex;align-items:center;gap:12px">
            <div>
              <div style="font-size:0.85rem;font-weight:600;color:var(--text)">${nome.split(' ').slice(0,2).join(' ')}</div>
              <div style="font-size:0.78rem;color:#f87171;margin-top:2px">R$ ${valor.toLocaleString('pt-BR')} em atraso</div>
            </div>
            <button class="btn btn-sm btn-danger" onclick="openCobrancaModal('${nome}', ${valor})">ğŸ“§ Cobrar</button>
          </div>`;
        }).join('')}
      </div>
    </div>` : ''}

    <div class="grid-2" style="margin-bottom:24px">
      <!-- PARCELAS POR CLIENTE -->
      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">Parcelas por Cliente</span>
          <button class="btn btn-gold btn-sm" onclick="openNovaCobranca()">+ Novo LanÃ§amento</button>
        </div>
        <div class="panel-body" style="padding:0">
          ${PARCELAS_DATA.map(c => {
            const pago = c.parcelas.filter(p=>p.status==='pago').reduce((a,p)=>a+p.valor,0);
            const pct  = Math.round(pago / c.valorTotal * 100);
            return `
            <div style="padding:14px 18px;border-bottom:1px solid var(--border2)">
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                <div>
                  <div style="font-size:0.85rem;font-weight:600;color:var(--text)">${c.cliente.split(' ').slice(0,2).join(' ')}</div>
                  <div style="font-size:0.72rem;color:var(--text3);margin-top:2px">${c.servico}</div>
                </div>
                <div style="text-align:right">
                  <div style="font-size:0.8rem;font-family:'DM Mono',monospace;color:var(--gold)">R$ ${pago.toLocaleString('pt-BR')} / ${c.valorTotal.toLocaleString('pt-BR')}</div>
                  <div style="font-size:0.68rem;color:var(--text3);margin-top:2px">${pct}% recebido</div>
                </div>
              </div>
              <div class="progress-bar"><div class="progress-fill" style="width:${pct}%"></div></div>
              <div style="display:flex;gap:6px;margin-top:10px;flex-wrap:wrap">
                ${c.parcelas.map(p=>`
                  <div style="flex:1;min-width:70px;background:var(--navy4);border-radius:8px;padding:8px;text-align:center;border:1px solid ${p.status==='atrasado'?'rgba(239,68,68,0.3)':p.status==='pago'?'rgba(16,185,129,0.2)':'var(--border2)'}">
                    <div style="font-size:0.65rem;color:var(--text3)">Parc. ${p.num}</div>
                    <div style="font-size:0.78rem;font-weight:600;color:var(--text);font-family:'DM Mono',monospace">R$${(p.valor/1000).toFixed(1)}k</div>
                    <div style="margin-top:4px"><span class="badge ${stColor[p.status]}" style="font-size:0.6rem;padding:2px 6px">${stLabel[p.status]}</span></div>
                    <div style="font-size:0.62rem;color:var(--text3);margin-top:3px">${p.venc}</div>
                  </div>`).join('')}
              </div>
            </div>`;
          }).join('')}
        </div>
      </div>

      <!-- PAINEL DIREITO: recibos + grÃ¡fico -->
      <div style="display:flex;flex-direction:column;gap:20px">

        <!-- GRÃFICO RECEBIMENTOS -->
        <div class="panel">
          <div class="panel-header"><span class="panel-title">Recebimentos vs. InadimplÃªncia</span></div>
          <div class="panel-body">
            <div style="display:flex;gap:16px;margin-bottom:16px">
              ${[['Recebido','var(--green)',totalRecebido,totalGeral],['Pendente','var(--gold)',totalPendente,totalGeral],['Atrasado','var(--red)',totalAtrasado,totalGeral]].map(([label,cor,val,tot])=>`
                <div style="flex:1;text-align:center">
                  <div style="width:60px;height:60px;border-radius:50%;background:conic-gradient(${cor} ${Math.round(val/tot*360)}deg, var(--navy4) 0deg);margin:0 auto 8px;display:flex;align-items:center;justify-content:center">
                    <div style="width:40px;height:40px;border-radius:50%;background:var(--navy3);display:flex;align-items:center;justify-content:center;font-size:0.68rem;font-weight:700;color:${cor}">${Math.round(val/tot*100)}%</div>
                  </div>
                  <div style="font-size:0.72rem;color:var(--text3)">${label}</div>
                  <div style="font-size:0.8rem;font-weight:600;color:${cor};font-family:'DM Mono',monospace">R$${(val/1000).toFixed(1)}k</div>
                </div>`).join('')}
            </div>
          </div>
        </div>

        <!-- RECIBOS -->
        <div class="panel">
          <div class="panel-header">
            <span class="panel-title">Recibos Emitidos</span>
            <button class="btn btn-outline btn-sm" onclick="openGerarRecibo()">+ Emitir Recibo</button>
          </div>
          <div class="panel-body" style="padding:0">
            <table class="tbl">
              <thead><tr><th>#</th><th>Cliente</th><th>Valor</th><th>Data</th><th></th></tr></thead>
              <tbody>
                ${todasParcelas.filter(p=>p.status==='pago').slice(0,5).map((p,i)=>`
                  <tr>
                    <td style="font-family:'DM Mono',monospace;font-size:0.72rem;color:var(--text3)">REC-${String(i+1).padStart(3,'0')}</td>
                    <td style="font-size:0.8rem">${p.cliente.split(' ').slice(0,2).join(' ')}</td>
                    <td style="font-family:'DM Mono',monospace;font-size:0.8rem;color:var(--gold)">R$ ${p.valor.toLocaleString('pt-BR')}</td>
                    <td style="font-size:0.72rem;color:var(--text3)">${p.dtPgto}</td>
                    <td><button class="btn btn-sm btn-outline" onclick="alert('Baixando recibo REC-${String(i+1).padStart(3,'0')}...')">â¬‡</button></td>
                  </tr>`).join('')}
              </tbody>
            </table>
          </div>
        </div>

      </div>
    </div>

    <!-- TODAS AS PARCELAS (tabela completa) -->
    <div class="panel">
      <div class="panel-header">
        <span class="panel-title">Todas as Parcelas</span>
        <div style="display:flex;gap:8px">
          <select id="filtro-status-parcela" onchange="filtrarParcelasStatus(this.value)" style="background:var(--navy2);border:1px solid var(--border2);border-radius:8px;padding:7px 12px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:0.78rem;outline:none">
            <option value="">Todos</option>
            <option value="atrasado">Atrasados</option>
            <option value="pendente">Pendentes</option>
            <option value="pago">Pagos</option>
          </select>
          <button class="btn btn-outline btn-sm" onclick="alert('Exportando relatÃ³rio financeiro...')">ğŸ“„ Exportar</button>
        </div>
      </div>
      <div id="tabela-parcelas-body" class="panel-body" style="padding:0">
        ${tabelaParcelasHTML(todasParcelas)}
      </div>
    </div>
  `;
}

function tabelaParcelasHTML(lista) {
  const stColor = { pago:'badge-green', pendente:'badge-gold', atrasado:'badge-red' };
  const stLabel = { pago:'âœ“ Pago', pendente:'â³ Pendente', atrasado:'ğŸš¨ Atrasado' };
  if (!lista.length) return `<div style="text-align:center;padding:30px;color:var(--text3)">Nenhuma parcela encontrada.</div>`;
  return `<table class="tbl">
    <thead><tr><th>Cliente</th><th>ServiÃ§o</th><th>Parcela</th><th>Valor</th><th>Vencimento</th><th>Status</th><th>Pgto</th><th>AÃ§Ãµes</th></tr></thead>
    <tbody>
      ${lista.map((p,i)=>`
        <tr>
          <td style="font-weight:500;color:var(--text)">${p.cliente.split(' ').slice(0,2).join(' ')}</td>
          <td style="font-size:0.75rem">${servicoBadge(p.servico)}</td>
          <td style="font-family:'DM Mono',monospace;font-size:0.75rem;color:var(--text3)">Parc. ${p.num}</td>
          <td style="font-family:'DM Mono',monospace;color:var(--gold);font-size:0.82rem">R$ ${p.valor.toLocaleString('pt-BR')}</td>
          <td style="font-family:'DM Mono',monospace;font-size:0.78rem;color:${p.status==='atrasado'?'#f87171':'var(--text2)'}">${p.venc}</td>
          <td><span class="badge ${stColor[p.status]}">${stLabel[p.status]}</span></td>
          <td style="font-size:0.75rem;color:var(--text3)">${p.dtPgto||'â€”'}</td>
          <td style="display:flex;gap:5px">
            ${p.status!=='pago'?`<button class="btn btn-sm btn-gold" onclick="marcarPago('${p.cliente}',${p.num})">âœ“</button>`:''}
            ${p.status==='atrasado'?`<button class="btn btn-sm btn-danger" onclick="openCobrancaModal('${p.cliente}',${p.valor})">ğŸ“§</button>`:''}
          </td>
        </tr>`).join('')}
    </tbody>
  </table>`;
}

function filtrarParcelasStatus(st) {
  const todasParcelas = PARCELAS_DATA.flatMap(c => c.parcelas.map(p => ({...p, cliente: c.cliente, servico: c.servico})));
  const lista = st ? todasParcelas.filter(p=>p.status===st) : todasParcelas;
  const el = document.getElementById('tabela-parcelas-body');
  if (el) el.innerHTML = tabelaParcelasHTML(lista);
}

function marcarPago(clienteNome, numParcela) {
  const contrato = PARCELAS_DATA.find(c=>c.cliente===clienteNome);
  if (contrato) {
    const parc = contrato.parcelas.find(p=>p.num===numParcela);
    if (parc) {
      parc.status = 'pago';
      parc.dtPgto = new Date().toLocaleDateString('pt-BR');
      navigateTo('financeiro-avancado');
    }
  }
}

function openCobrancaModal(cliente, valor) {
  openModal(`
    <div class="modal-title">ğŸ“§ Enviar CobranÃ§a</div>
    <div style="background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.2);border-radius:12px;padding:16px;margin-bottom:20px">
      <div style="font-size:0.85rem;font-weight:600;color:var(--text)">${cliente}</div>
      <div style="font-size:0.82rem;color:#f87171;margin-top:4px">Valor em atraso: R$ ${valor.toLocaleString('pt-BR')}</div>
    </div>
    <div class="form-grid">
      <div class="form-field form-full"><label>Canal de envio</label>
        <select><option>E-mail</option><option>WhatsApp</option><option>E-mail + WhatsApp</option></select>
      </div>
      <div class="form-field form-full"><label>Mensagem personalizada</label>
        <textarea style="min-height:110px">Prezado(a) ${cliente}, identificamos que sua(s) parcela(s) referente ao serviÃ§o contratado junto Ã  WB Assessoria MigratÃ³ria estÃ£o em aberto. Por gentileza, entre em contato para regularizaÃ§Ã£o.</textarea>
      </div>
      <div class="form-field"><label>Incluir boleto/PIX?</label><select><option>Sim â€“ gerar QR Code PIX</option><option>Sim â€“ gerar boleto</option><option>NÃ£o</option></select></div>
      <div class="form-field"><label>Nova data de vencimento</label><input type="date"></div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-gold" onclick="alert('CobranÃ§a enviada para ${cliente}!');closeModal()">ğŸ“¤ Enviar CobranÃ§a</button>
      <button class="btn btn-outline" onclick="closeModal()">Cancelar</button>
    </div>
  `);
}

function openNovaCobranca() {
  openModal(`
    <div class="modal-title">+ Novo LanÃ§amento Financeiro</div>
    <div class="form-grid">
      <div class="form-field"><label>Cliente</label><select>${clientes.map(c=>`<option>${c.nome}</option>`).join('')}</select></div>
      <div class="form-field"><label>Tipo</label><select><option>HonorÃ¡rios</option><option>Taxa governamental</option><option>TraduÃ§Ã£o</option><option>Despesa cartÃ³rio</option><option>Reembolso</option></select></div>
      <div class="form-field"><label>Valor (R$)</label><input type="number" placeholder="0,00"></div>
      <div class="form-field"><label>Forma de Pagamento</label><select><option>PIX</option><option>Boleto</option><option>CartÃ£o â€“ Ã  vista</option><option>CartÃ£o â€“ 2x</option><option>CartÃ£o â€“ 3x</option><option>TransferÃªncia</option></select></div>
      <div class="form-field"><label>Vencimento</label><input type="date"></div>
      <div class="form-field"><label>Status</label><select><option>pendente</option><option>pago</option></select></div>
      <div class="form-field form-full"><label>ObservaÃ§Ã£o</label><input placeholder="Ex: 1Âª parcela â€“ contrato naturalizaÃ§Ã£o"></div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-gold" onclick="alert('LanÃ§amento registrado!');closeModal()">Registrar</button>
      <button class="btn btn-outline" onclick="closeModal()">Cancelar</button>
    </div>
  `);
}

function openGerarRecibo() {
  openModal(`
    <div class="modal-title">ğŸ§¾ Emitir Recibo</div>
    <div class="form-grid">
      <div class="form-field"><label>Cliente</label><select>${clientes.map(c=>`<option>${c.nome}</option>`).join('')}</select></div>
      <div class="form-field"><label>ServiÃ§o</label><select><option>NaturalizaÃ§Ã£o Brasileira</option><option>AutorizaÃ§Ã£o de ResidÃªncia (RNM)</option><option>Visto de Turismo (EUA)</option></select></div>
      <div class="form-field"><label>Valor Recebido (R$)</label><input type="number" placeholder="0,00"></div>
      <div class="form-field"><label>Data do Pagamento</label><input type="date"></div>
      <div class="form-field"><label>Forma de Pagamento</label><select><option>PIX</option><option>Boleto</option><option>CartÃ£o de CrÃ©dito</option><option>TransferÃªncia BancÃ¡ria</option><option>Dinheiro</option></select></div>
      <div class="form-field form-full"><label>Referente a</label><input placeholder="Ex: Parcela 1 de 3 â€“ HonorÃ¡rios NaturalizaÃ§Ã£o"></div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-gold" onclick="alert('Recibo gerado e enviado ao cliente!');closeModal()">ğŸ–¨ï¸ Gerar & Enviar</button>
      <button class="btn btn-outline" onclick="closeModal()">Cancelar</button>
    </div>
  `);
}
</script>
  const items = [
    { q:'Como acompanho meu processo?', a:'Acesse o menu "Meu Processo" para ver o status atualizado, as etapas concluÃ­das e o que ainda falta. Nossa equipe atualiza o sistema em tempo real.' },
    { q:'Como envio meus documentos?', a:'Acesse "Meus Documentos" e clique em "Enviar" ao lado de cada documento pendente. Aceitamos PDF, JPG e PNG de atÃ© 10MB.' },
    { q:'Quanto tempo leva meu processo?', a:'NaturalizaÃ§Ã£o Brasileira: atÃ© 180 dias apÃ³s protocolo. AutorizaÃ§Ã£o de ResidÃªncia (RNM): 2 a 6 meses. Visto de Turismo EUA: 1 a 6 meses.' },
    { q:'Preciso ir pessoalmente a algum Ã³rgÃ£o?', a:'Sim. Para a NaturalizaÃ§Ã£o, o protocolo pode ser feito online via Gov.BR, mas a assinatura do certificado Ã© presencial. Para o RNM, o atendimento na PolÃ­cia Federal Ã© obrigatÃ³rio. Para o Visto EUA, a entrevista consular Ã© obrigatÃ³ria.' },
    { q:'Como entro em contato com minha assessora?', a:'Use o chat "Mensagens" disponÃ­vel aqui no portal. Nossa equipe responde em horÃ¡rio comercial (segâ€“sex, 9hâ€“18h).' },
    { q:'O que Ã© Apostila de Haia?', a:'Ã‰ a autenticaÃ§Ã£o internacional de documentos emitidos no exterior, reconhecida por mais de 120 paÃ­ses. Substitui a legalizaÃ§Ã£o consular. NecessÃ¡ria para certidÃµes estrangeiras apresentadas no Brasil.' },
    { q:'Meu processo pode ser negado?', a:'Infelizmente sim, em casos de documentaÃ§Ã£o incompleta, antecedentes criminais ou prazo insuficiente de residÃªncia. Por isso, a assessoria especializada da WB Ã© essencial para maximizar suas chances de aprovaÃ§Ã£o.' },
  ];
  return `
    <div style="max-width:700px;margin:0 auto">
      <div class="client-header" style="margin-bottom:24px;text-align:center">
        <div class="client-name">ğŸ’¬ DÃºvidas Frequentes</div>
        <div class="client-process">Tudo que vocÃª precisa saber sobre seu processo migratÃ³rio</div>
      </div>
      <div class="panel">
        <div class="panel-body" style="display:flex;flex-direction:column;gap:0">
          ${items.map((item,i)=>`
            <div style="border-bottom:${i<items.length-1?'1px solid var(--border2)':'none'};padding:16px 0">
              <div style="font-size:0.88rem;font-weight:600;color:var(--gold);cursor:pointer;display:flex;justify-content:space-between;align-items:flex-start;gap:12px" onclick="var a=this.nextElementSibling;a.style.display=a.style.display==='block'?'none':'block'">
                <span>${item.q}</span><span style="flex-shrink:0">â–¼</span>
              </div>
              <div style="display:none;font-size:0.83rem;color:var(--text2);margin-top:10px;line-height:1.65;padding:12px;background:var(--navy4);border-radius:8px">${item.a}</div>
            </div>`).join('')}
        </div>
      </div>
      <div style="text-align:center;margin-top:20px">
        <button class="btn btn-gold" onclick="navigateTo('mensagens-cliente')">ğŸ’¬ Falar com a Equipe WB</button>
      </div>
    </div>
  `;
}
</script>
</body>
</html>
